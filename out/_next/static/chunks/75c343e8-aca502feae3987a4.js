"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{15918:function(e,t,n){n.d(t,{L9:function(){return t_},_F:function(){return tx},iV:function(){return tG},q$:function(){return tC}});var r,i,l,o,a,s,c=n(9268),h=n(86006),f=n(54130),d=n(22461),p=n(93477),u=n(63623),g=n(14385),m=n(70172),y=n(79372),k=n(39769),v=n(2746),_=n.n(v),b=n(44005),x=n(92178),w=n(52138),M=n(48172),E=n.n(M),N=n(41671),T=n.n(N),D=n(41972),A=n.n(D),C=n(53671),S=n.n(C),L=n(33563),P=n.n(L),R=n(4974),I=n.n(R),B=n(28223),j=n(74331),O=n.n(j),Y=n(782),W=n.n(Y),z=n(74679),J=n.n(z),V=n(20075),F=n.n(V),U=n(8650),$=n.n(U),H=n(64774),q=n.n(H),Z=n(34268),G=n(92844),K=n(56762),X=n.n(K),Q=n(53574);function ee(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function et(e){return k.V.compile({name:"blockTypeSchema",types:[e]}).get(e.name)}function en(e){var t,n,r;if(!e)throw Error("Parameter 'portabletextType' missing (required)");let i=null==(t=e.of)?void 0:t.find(function e(t){return t.type?e(t.type):"block"===t.name?t:null});if(!i)throw Error("Block type is not defined in this schema (required)");let l=null==(n=i.fields)?void 0:n.find(e=>"children"===e.name);if(!l)throw Error("Children field for block type found in schema (required)");let o=l.type.of;if(!o)throw Error("Valid types for block children not found in schema (required)");let a=o.find(e=>"span"===e.name);if(!a)throw Error("Span type not found in schema (required)");let s=o.filter(e=>"span"!==e.name)||[],c=(null==(r=e.of)?void 0:r.filter(e=>e.name!==i.name))||[];return{styles:function(e){var t,n,r;let i=null==(t=e.fields)?void 0:t.find(e=>"style"===e.name);if(!i)throw Error("A field with name 'style' is not defined in the block type (required).");let l=(null==(n=i.type.options)?void 0:n.list)&&(null==(r=i.type.options.list)?void 0:r.filter(e=>e.value));if(!l||0===l.length)throw Error("The style fields need at least one style defined. I.e: {title: 'Normal', value: 'normal'}.");return l}(i),decorators:a.decorators,lists:function(e){var t,n;let r=null==(t=e.fields)?void 0:t.find(e=>"list"===e.name);if(!r)throw Error("A field with name 'list' is not defined in the block type (required).");let i=(null==(n=r.type.options)?void 0:n.list)&&r.type.options.list.filter(e=>e.value);if(!i)throw Error("The list field need at least to be an empty array");return i}(i),block:i,span:a,portableText:e,inlineObjects:s,blockObjects:c,annotations:a.annotations}}let er="sanity-pte:";function ei(e){let t="".concat(er).concat(e);return _()&&_().enabled(t)?_()(t):_()(er)}_()(er);let el=()=>(0,b.E2)(12),eo=(0,h.createContext)(el),ea=()=>{let e=(0,h.useContext)(eo);if(void 0===e)throw Error("The `usePortableTextEditorKeyGenerator` hook must be used inside the <PortableTextEditor> component's context.");return e},es=new WeakMap,ec=new WeakMap,eh=new WeakMap,ef=new WeakMap,ed=new WeakMap,ep=new WeakMap,eu=new WeakMap;var eg={exports:{}};r=eg,(i=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}).Diff=function(e,t){return[e,t]},i.prototype.diff_main=function(e,t,n,r){void 0===r&&(r=this.Diff_Timeout<=0?Number.MAX_VALUE:new Date().getTime()+1e3*this.Diff_Timeout);var l=r;if(null==e||null==t)throw Error("Null input. (diff_main)");if(e==t)return e?[new i.Diff(0,e)]:[];void 0===n&&(n=!0);var o=n,a=this.diff_commonPrefix(e,t),s=e.substring(0,a);e=e.substring(a),t=t.substring(a),a=this.diff_commonSuffix(e,t);var c=e.substring(e.length-a);e=e.substring(0,e.length-a),t=t.substring(0,t.length-a);var h=this.diff_compute_(e,t,o,l);return s&&h.unshift(new i.Diff(0,s)),c&&h.push(new i.Diff(0,c)),this.diff_cleanupMerge(h),h},i.prototype.diff_compute_=function(e,t,n,r){if(!e)return[new i.Diff(1,t)];if(!t)return[new i.Diff(-1,e)];var l,o=e.length>t.length?e:t,a=e.length>t.length?t:e,s=o.indexOf(a);if(-1!=s)return l=[new i.Diff(1,o.substring(0,s)),new i.Diff(0,a),new i.Diff(1,o.substring(s+a.length))],e.length>t.length&&(l[0][0]=l[2][0]=-1),l;if(1==a.length)return[new i.Diff(-1,e),new i.Diff(1,t)];var c=this.diff_halfMatch_(e,t);if(c){var h=c[0],f=c[1],d=c[2],p=c[3],u=c[4],g=this.diff_main(h,d,n,r),m=this.diff_main(f,p,n,r);return g.concat([new i.Diff(0,u)],m)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,r):this.diff_bisect_(e,t,r)},i.prototype.diff_lineMode_=function(e,t,n){var r=this.diff_linesToChars_(e,t);e=r.chars1,t=r.chars2;var l=r.lineArray,o=this.diff_main(e,t,!1,n);this.diff_charsToLines_(o,l),this.diff_cleanupSemantic(o),o.push(new i.Diff(0,""));for(var a=0,s=0,c=0,h="",f="";a<o.length;){switch(o[a][0]){case 1:c++,f+=o[a][1];break;case -1:s++,h+=o[a][1];break;case 0:if(s>=1&&c>=1){o.splice(a-s-c,s+c),a=a-s-c;for(var d=this.diff_main(h,f,!1,n),p=d.length-1;p>=0;p--)o.splice(a,0,d[p]);a+=d.length}c=0,s=0,h="",f=""}a++}return o.pop(),o},i.prototype.diff_bisect_=function(e,t,n){for(var r=e.length,l=t.length,o=Math.ceil((r+l)/2),a=2*o,s=Array(a),c=Array(a),h=0;h<a;h++)s[h]=-1,c[h]=-1;s[o+1]=0,c[o+1]=0;for(var f=r-l,d=f%2!=0,p=0,u=0,g=0,m=0,y=0;y<o&&!(new Date().getTime()>n);y++){for(var k=-y+p;k<=y-u;k+=2){for(var v,_=o+k,b=(v=k==-y||k!=y&&s[_-1]<s[_+1]?s[_+1]:s[_-1]+1)-k;v<r&&b<l&&e.charAt(v)==t.charAt(b);)v++,b++;if(s[_]=v,v>r)u+=2;else if(b>l)p+=2;else if(d){var x=o+f-k;if(x>=0&&x<a&&-1!=c[x]){var w=r-c[x];if(v>=w)return this.diff_bisectSplit_(e,t,v,b,n)}}}for(var M=-y+g;M<=y-m;M+=2){for(var w,x=o+M,E=(w=M==-y||M!=y&&c[x-1]<c[x+1]?c[x+1]:c[x-1]+1)-M;w<r&&E<l&&e.charAt(r-w-1)==t.charAt(l-E-1);)w++,E++;if(c[x]=w,w>r)m+=2;else if(E>l)g+=2;else if(!d){var _=o+f-M;if(_>=0&&_<a&&-1!=s[_]){var v=s[_],b=o+v-_;if(v>=(w=r-w))return this.diff_bisectSplit_(e,t,v,b,n)}}}}return[new i.Diff(-1,e),new i.Diff(1,t)]},i.prototype.diff_bisectSplit_=function(e,t,n,r,i){var l=e.substring(0,n),o=t.substring(0,r),a=e.substring(n),s=t.substring(r),c=this.diff_main(l,o,!1,i),h=this.diff_main(a,s,!1,i);return c.concat(h)},i.prototype.diff_linesToChars_=function(e,t){var n=[],r={};function i(e){for(var t="",i=0,o=-1,a=n.length;o<e.length-1;){-1==(o=e.indexOf("\n",i))&&(o=e.length-1);var s=e.substring(i,o+1);(r.hasOwnProperty?r.hasOwnProperty(s):void 0!==r[s])?t+=String.fromCharCode(r[s]):(a==l&&(s=e.substring(i),o=e.length),t+=String.fromCharCode(a),r[s]=a,n[a++]=s),i=o+1}return t}n[0]="";var l=4e4;return l=65535,{chars1:i(e),chars2:i(t),lineArray:n}},i.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var r=e[n][1],i=[],l=0;l<r.length;l++)i[l]=t[r.charCodeAt(l)];e[n][1]=i.join("")}},i.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,l=0;n<i;)e.substring(l,i)==t.substring(l,i)?l=n=i:r=i,i=Math.floor((r-n)/2+n);return i},i.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,l=0;n<i;)e.substring(e.length-i,e.length-l)==t.substring(t.length-i,t.length-l)?l=n=i:r=i,i=Math.floor((r-n)/2+n);return i},i.prototype.diff_commonOverlap_=function(e,t){var n=e.length,r=t.length;if(0==n||0==r)return 0;n>r?e=e.substring(n-r):n<r&&(t=t.substring(0,n));var i=Math.min(n,r);if(e==t)return i;for(var l=0,o=1;;){var a=e.substring(i-o),s=t.indexOf(a);if(-1==s)return l;o+=s,(0==s||e.substring(i-o)==t.substring(0,o))&&(l=o,o++)}},i.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var n,r,i,l,o,a=e.length>t.length?e:t,s=e.length>t.length?t:e;if(a.length<4||2*s.length<a.length)return null;var c=this;function h(e,t,n){for(var r,i,l,o,a=e.substring(n,n+Math.floor(e.length/4)),s=-1,h="";-1!=(s=t.indexOf(a,s+1));){var f=c.diff_commonPrefix(e.substring(n),t.substring(s)),d=c.diff_commonSuffix(e.substring(0,n),t.substring(0,s));h.length<d+f&&(h=t.substring(s-d,s)+t.substring(s,s+f),r=e.substring(0,n-d),i=e.substring(n+f),l=t.substring(0,s-d),o=t.substring(s+f))}return 2*h.length>=e.length?[r,i,l,o,h]:null}var f=h(a,s,Math.ceil(a.length/4)),d=h(a,s,Math.ceil(a.length/2));return f||d?(n=d?f&&f[4].length>d[4].length?f:d:f,e.length>t.length?(r=n[0],i=n[1],l=n[2],o=n[3]):(l=n[0],o=n[1],r=n[2],i=n[3]),[r,i,l,o,n[4]]):null},i.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],r=0,l=null,o=0,a=0,s=0,c=0,h=0;o<e.length;)0==e[o][0]?(n[r++]=o,a=c,s=h,c=0,h=0,l=e[o][1]):(1==e[o][0]?c+=e[o][1].length:h+=e[o][1].length,l&&l.length<=Math.max(a,s)&&l.length<=Math.max(c,h)&&(e.splice(n[r-1],0,new i.Diff(-1,l)),e[n[r-1]+1][0]=1,r--,o=--r>0?n[r-1]:-1,a=0,s=0,c=0,h=0,l=null,t=!0)),o++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),o=1;o<e.length;){if(-1==e[o-1][0]&&1==e[o][0]){var f=e[o-1][1],d=e[o][1],p=this.diff_commonOverlap_(f,d),u=this.diff_commonOverlap_(d,f);p>=u?(p>=f.length/2||p>=d.length/2)&&(e.splice(o,0,new i.Diff(0,d.substring(0,p))),e[o-1][1]=f.substring(0,f.length-p),e[o+1][1]=d.substring(p),o++):(u>=f.length/2||u>=d.length/2)&&(e.splice(o,0,new i.Diff(0,f.substring(0,u))),e[o-1][0]=1,e[o-1][1]=d.substring(0,d.length-u),e[o+1][0]=-1,e[o+1][1]=f.substring(u),o++),o++}o++}},i.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),r=t.charAt(0),l=n.match(i.nonAlphaNumericRegex_),o=r.match(i.nonAlphaNumericRegex_),a=l&&n.match(i.whitespaceRegex_),s=o&&r.match(i.whitespaceRegex_),c=a&&n.match(i.linebreakRegex_),h=s&&r.match(i.linebreakRegex_),f=c&&e.match(i.blanklineEndRegex_),d=h&&t.match(i.blanklineStartRegex_);return f||d?5:c||h?4:l&&!a&&s?3:a||s?2:l||o?1:0}for(var n=1;n<e.length-1;){if(0==e[n-1][0]&&0==e[n+1][0]){var r=e[n-1][1],l=e[n][1],o=e[n+1][1],a=this.diff_commonSuffix(r,l);if(a){var s=l.substring(l.length-a);r=r.substring(0,r.length-a),l=s+l.substring(0,l.length-a),o=s+o}for(var c=r,h=l,f=o,d=t(r,l)+t(l,o);l.charAt(0)===o.charAt(0);){r+=l.charAt(0),l=l.substring(1)+o.charAt(0),o=o.substring(1);var p=t(r,l)+t(l,o);p>=d&&(d=p,c=r,h=l,f=o)}e[n-1][1]!=c&&(c?e[n-1][1]=c:(e.splice(n-1,1),n--),e[n][1]=h,f?e[n+1][1]=f:(e.splice(n+1,1),n--))}n++}},i.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,i.whitespaceRegex_=/\s/,i.linebreakRegex_=/[\r\n]/,i.blanklineEndRegex_=/\n\r?\n$/,i.blanklineStartRegex_=/^\r?\n\r?\n/,i.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,n=[],r=0,l=null,o=0,a=!1,s=!1,c=!1,h=!1;o<e.length;)0==e[o][0]?(e[o][1].length<this.Diff_EditCost&&(c||h)?(n[r++]=o,a=c,s=h,l=e[o][1]):(r=0,l=null),c=h=!1):(-1==e[o][0]?h=!0:c=!0,l&&(a&&s&&c&&h||l.length<this.Diff_EditCost/2&&a+s+c+h==3)&&(e.splice(n[r-1],0,new i.Diff(-1,l)),e[n[r-1]+1][0]=1,r--,l=null,a&&s?(c=h=!0,r=0):(o=--r>0?n[r-1]:-1,c=h=!1),t=!0)),o++;t&&this.diff_cleanupMerge(e)},i.prototype.diff_cleanupMerge=function(e){e.push(new i.Diff(0,""));for(var t,n=0,r=0,l=0,o="",a="";n<e.length;)switch(e[n][0]){case 1:l++,a+=e[n][1],n++;break;case -1:r++,o+=e[n][1],n++;break;case 0:r+l>1?(0!==r&&0!==l&&(0!==(t=this.diff_commonPrefix(a,o))&&(n-r-l>0&&0==e[n-r-l-1][0]?e[n-r-l-1][1]+=a.substring(0,t):(e.splice(0,0,new i.Diff(0,a.substring(0,t))),n++),a=a.substring(t),o=o.substring(t)),0!==(t=this.diff_commonSuffix(a,o))&&(e[n][1]=a.substring(a.length-t)+e[n][1],a=a.substring(0,a.length-t),o=o.substring(0,o.length-t))),n-=r+l,e.splice(n,r+l),o.length&&(e.splice(n,0,new i.Diff(-1,o)),n++),a.length&&(e.splice(n,0,new i.Diff(1,a)),n++),n++):0!==n&&0==e[n-1][0]?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,l=0,r=0,o="",a=""}""===e[e.length-1][1]&&e.pop();var s=!1;for(n=1;n<e.length-1;)0==e[n-1][0]&&0==e[n+1][0]&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),s=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),s=!0)),n++;s&&this.diff_cleanupMerge(e)},i.prototype.diff_xIndex=function(e,t){var n,r=0,i=0,l=0,o=0;for(n=0;n<e.length&&(1!==e[n][0]&&(r+=e[n][1].length),-1!==e[n][0]&&(i+=e[n][1].length),!(r>t));n++)l=r,o=i;return e.length!=n&&-1===e[n][0]?o:o+(t-l)},i.prototype.diff_prettyHtml=function(e){for(var t=[],n=/&/g,r=/</g,i=/>/g,l=/\n/g,o=0;o<e.length;o++){var a=e[o][0],s=e[o][1].replace(n,"&amp;").replace(r,"&lt;").replace(i,"&gt;").replace(l,"&para;<br>");switch(a){case 1:t[o]='<ins style="background:#e6ffe6;">'+s+"</ins>";break;case -1:t[o]='<del style="background:#ffe6e6;">'+s+"</del>";break;case 0:t[o]="<span>"+s+"</span>"}}return t.join("")},i.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)-1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_levenshtein=function(e){for(var t=0,n=0,r=0,i=0;i<e.length;i++){var l=e[i][0],o=e[i][1];switch(l){case 1:n+=o.length;break;case -1:r+=o.length;break;case 0:t+=Math.max(n,r),n=0,r=0}}return t+Math.max(n,r)},i.prototype.diff_toDelta=function(e){for(var t=[],n=0;n<e.length;n++)switch(e[n][0]){case 1:t[n]="+"+encodeURI(e[n][1]);break;case -1:t[n]="-"+e[n][1].length;break;case 0:t[n]="="+e[n][1].length}return t.join("	").replace(/%20/g," ")},i.prototype.diff_fromDelta=function(e,t){for(var n=[],r=0,l=0,o=t.split(/\t/g),a=0;a<o.length;a++){var s=o[a].substring(1);switch(o[a].charAt(0)){case"+":try{n[r++]=new i.Diff(1,decodeURI(s))}catch(e){throw Error("Illegal escape in diff_fromDelta: "+s)}break;case"-":case"=":var c=parseInt(s,10);if(isNaN(c)||c<0)throw Error("Invalid number in diff_fromDelta: "+s);var h=e.substring(l,l+=c);"="==o[a].charAt(0)?n[r++]=new i.Diff(0,h):n[r++]=new i.Diff(-1,h);break;default:if(o[a])throw Error("Invalid diff operation in diff_fromDelta: "+o[a])}}if(l!=e.length)throw Error("Delta length ("+l+") does not equal source text length ("+e.length+").");return n},i.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw Error("Null input. (match_main)");return(n=Math.max(0,Math.min(n,e.length)),e==t)?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},i.prototype.match_bitap_=function(e,t,n){if(t.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var r,i,l,o=this.match_alphabet_(t),a=this;function s(e,r){var i=e/t.length,l=Math.abs(n-r);return a.Match_Distance?i+l/a.Match_Distance:l?1:i}var c=this.Match_Threshold,h=e.indexOf(t,n);-1!=h&&(c=Math.min(s(0,h),c),-1!=(h=e.lastIndexOf(t,n+t.length))&&(c=Math.min(s(0,h),c)));var f=1<<t.length-1;h=-1;for(var d=t.length+e.length,p=0;p<t.length;p++){for(r=0,i=d;r<i;)s(p,n+i)<=c?r=i:d=i,i=Math.floor((d-r)/2+r);d=i;var u=Math.max(1,n-i+1),g=Math.min(n+i,e.length)+t.length,m=Array(g+2);m[g+1]=(1<<p)-1;for(var y=g;y>=u;y--){var k=o[e.charAt(y-1)];if(0===p?m[y]=(m[y+1]<<1|1)&k:m[y]=(m[y+1]<<1|1)&k|((l[y+1]|l[y])<<1|1)|l[y+1],m[y]&f){var v=s(p,y-1);if(v<=c){if(c=v,(h=y-1)>n)u=Math.max(1,2*n-h);else break}}}if(s(p+1,n)>c)break;l=m}return h},i.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(var n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},i.prototype.patch_addContext_=function(e,t){if(0!=t.length){if(null===e.start2)throw Error("patch not initialized");for(var n=t.substring(e.start2,e.start2+e.length1),r=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,n=t.substring(e.start2-r,e.start2+e.length1+r);r+=this.Patch_Margin;var l=t.substring(e.start2-r,e.start2);l&&e.diffs.unshift(new i.Diff(0,l));var o=t.substring(e.start2+e.length1,e.start2+e.length1+r);o&&e.diffs.push(new i.Diff(0,o)),e.start1-=l.length,e.start2-=l.length,e.length1+=l.length+o.length,e.length2+=l.length+o.length}},i.prototype.patch_make=function(e,t,n){if("string"==typeof e&&"string"==typeof t&&void 0===n)r=e,(l=this.diff_main(r,t,!0)).length>2&&(this.diff_cleanupSemantic(l),this.diff_cleanupEfficiency(l));else if(e&&"object"==typeof e&&void 0===t&&void 0===n)l=e,r=this.diff_text1(l);else if("string"==typeof e&&t&&"object"==typeof t&&void 0===n)r=e,l=t;else if("string"==typeof e&&"string"==typeof t&&n&&"object"==typeof n)r=e,l=n;else throw Error("Unknown call format to patch_make.");if(0===l.length)return[];for(var r,l,o=[],a=new i.patch_obj,s=0,c=0,h=0,f=r,d=r,p=0;p<l.length;p++){var u=l[p][0],g=l[p][1];switch(s||0===u||(a.start1=c,a.start2=h),u){case 1:a.diffs[s++]=l[p],a.length2+=g.length,d=d.substring(0,h)+g+d.substring(h);break;case -1:a.length1+=g.length,a.diffs[s++]=l[p],d=d.substring(0,h)+d.substring(h+g.length);break;case 0:g.length<=2*this.Patch_Margin&&s&&l.length!=p+1?(a.diffs[s++]=l[p],a.length1+=g.length,a.length2+=g.length):g.length>=2*this.Patch_Margin&&s&&(this.patch_addContext_(a,f),o.push(a),a=new i.patch_obj,s=0,f=d,c=h)}1!==u&&(c+=g.length),-1!==u&&(h+=g.length)}return s&&(this.patch_addContext_(a,f),o.push(a)),o},i.prototype.patch_deepCopy=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],l=new i.patch_obj;l.diffs=[];for(var o=0;o<r.diffs.length;o++)l.diffs[o]=new i.Diff(r.diffs[o][0],r.diffs[o][1]);l.start1=r.start1,l.start2=r.start2,l.length1=r.length1,l.length2=r.length2,t[n]=l}return t},i.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);t=n+t+n,this.patch_splitMax(e);for(var r=0,i=[],l=0;l<e.length;l++){var o=e[l].start2+r,a=this.diff_text1(e[l].diffs),s=-1;if(a.length>this.Match_MaxBits?-1!=(h=this.match_main(t,a.substring(0,this.Match_MaxBits),o))&&(-1==(s=this.match_main(t,a.substring(a.length-this.Match_MaxBits),o+a.length-this.Match_MaxBits))||h>=s)&&(h=-1):h=this.match_main(t,a,o),-1==h)i[l]=!1,r-=e[l].length2-e[l].length1;else if(i[l]=!0,r=h-o,f=-1==s?t.substring(h,h+a.length):t.substring(h,s+this.Match_MaxBits),a==f)t=t.substring(0,h)+this.diff_text2(e[l].diffs)+t.substring(h+a.length);else{var c=this.diff_main(a,f,!1);if(a.length>this.Match_MaxBits&&this.diff_levenshtein(c)/a.length>this.Patch_DeleteThreshold)i[l]=!1;else{this.diff_cleanupSemanticLossless(c);for(var h,f,d,p=0,u=0;u<e[l].diffs.length;u++){var g=e[l].diffs[u];0!==g[0]&&(d=this.diff_xIndex(c,p)),1===g[0]?t=t.substring(0,h+d)+g[1]+t.substring(h+d):-1===g[0]&&(t=t.substring(0,h+d)+t.substring(h+this.diff_xIndex(c,p+g[1].length))),-1!==g[0]&&(p+=g[1].length)}}}}return[t=t.substring(n.length,t.length-n.length),i]},i.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",r=1;r<=t;r++)n+=String.fromCharCode(r);for(var r=0;r<e.length;r++)e[r].start1+=t,e[r].start2+=t;var l=e[0],o=l.diffs;if(0==o.length||0!=o[0][0])o.unshift(new i.Diff(0,n)),l.start1-=t,l.start2-=t,l.length1+=t,l.length2+=t;else if(t>o[0][1].length){var a=t-o[0][1].length;o[0][1]=n.substring(o[0][1].length)+o[0][1],l.start1-=a,l.start2-=a,l.length1+=a,l.length2+=a}if(0==(o=(l=e[e.length-1]).diffs).length||0!=o[o.length-1][0])o.push(new i.Diff(0,n)),l.length1+=t,l.length2+=t;else if(t>o[o.length-1][1].length){var a=t-o[o.length-1][1].length;o[o.length-1][1]+=n.substring(0,a),l.length1+=a,l.length2+=a}return n},i.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,n=0;n<e.length;n++)if(!(e[n].length1<=t)){var r=e[n];e.splice(n--,1);for(var l=r.start1,o=r.start2,a="";0!==r.diffs.length;){var s=new i.patch_obj,c=!0;for(s.start1=l-a.length,s.start2=o-a.length,""!==a&&(s.length1=s.length2=a.length,s.diffs.push(new i.Diff(0,a)));0!==r.diffs.length&&s.length1<t-this.Patch_Margin;){var h=r.diffs[0][0],f=r.diffs[0][1];1===h?(s.length2+=f.length,o+=f.length,s.diffs.push(r.diffs.shift()),c=!1):-1===h&&1==s.diffs.length&&0==s.diffs[0][0]&&f.length>2*t?(s.length1+=f.length,l+=f.length,c=!1,s.diffs.push(new i.Diff(h,f)),r.diffs.shift()):(f=f.substring(0,t-s.length1-this.Patch_Margin),s.length1+=f.length,l+=f.length,0===h?(s.length2+=f.length,o+=f.length):c=!1,s.diffs.push(new i.Diff(h,f)),f==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(f.length))}a=(a=this.diff_text2(s.diffs)).substring(a.length-this.Patch_Margin);var d=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);""!==d&&(s.length1+=d.length,s.length2+=d.length,0!==s.diffs.length&&0===s.diffs[s.diffs.length-1][0]?s.diffs[s.diffs.length-1][1]+=d:s.diffs.push(new i.Diff(0,d))),c||e.splice(++n,0,s)}}},i.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},i.prototype.patch_fromText=function(e){var t=[];if(!e)return t;for(var n=e.split("\n"),r=0,l=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<n.length;){var o=n[r].match(l);if(!o)throw Error("Invalid patch string: "+n[r]);var a=new i.patch_obj;for(t.push(a),a.start1=parseInt(o[1],10),""===o[2]?(a.start1--,a.length1=1):"0"==o[2]?a.length1=0:(a.start1--,a.length1=parseInt(o[2],10)),a.start2=parseInt(o[3],10),""===o[4]?(a.start2--,a.length2=1):"0"==o[4]?a.length2=0:(a.start2--,a.length2=parseInt(o[4],10)),r++;r<n.length;){var s=n[r].charAt(0);try{var c=decodeURI(n[r].substring(1))}catch(e){throw Error("Illegal escape in patch_fromText: "+c)}if("-"==s)a.diffs.push(new i.Diff(-1,c));else if("+"==s)a.diffs.push(new i.Diff(1,c));else if(" "==s)a.diffs.push(new i.Diff(0,c));else if("@"==s)break;else if(""===s);else throw Error('Invalid patch mode "'+s+'" in: '+c);r++}}return t},i.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},i.patch_obj.prototype.toString=function(){e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1;for(var e,t,n=["@@ -"+e+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],r=0;r<this.diffs.length;r++){switch(this.diffs[r][0]){case 1:t="+";break;case -1:t="-";break;case 0:t=" "}n[r+1]=t+encodeURI(this.diffs[r][1])+"\n"}return n.join("").replace(/%20/g," ")},r.exports=i,r.exports.diff_match_patch=i,r.exports.DIFF_DELETE=-1,r.exports.DIFF_INSERT=1,r.exports.DIFF_EQUAL=0;var em=eg.exports;function ey(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{type:"setIfMissing",path:t,value:e}}let ek=new em.diff_match_patch;function ev(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=ek.patch_make(e,t).map(e=>e.toString()).join("");return{type:"diffMatchPatch",path:n,value:r}}function e_(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return{type:"insert",path:n,position:t,items:e}}function eb(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{type:"set",path:t,value:e}}function ex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{type:"unset",path:e}}let ew=[];function eM(e,t){let n=t[e._key];return n&&I()(e,n)?n:(t[e._key]=e,e)}function eE(e,t){let{schemaTypes:n}=t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e&&Array.isArray(e)?e.map(e=>{let{_type:t,_key:i,...l}=e,o=[{_key:"".concat(i,"-void-child"),_type:"span",text:"",marks:[]}],a=e&&e._type===n.block.name;if(a){let a=!1,s=void 0===e.style,c=void 0===e.markDefs,h=e.children.map(e=>{let{_type:t,_key:n,...i}=e;return"span"!==t?(a=!0,eM({_type:t,_key:n,children:o,value:i,__inline:!0},r)):e});return!s&&!c&&!a&&w.W_.isElement(e)?e:(s&&(l.style=n.styles[0].value),c&&(l.markDefs=ew),eM({_type:t,_key:i,...l,children:h},r))}return eM({_type:t,_key:i,children:o,value:l},r)}):[]}function eN(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.map(e=>{let{_key:r,_type:i}=e;if(!r||!i)throw Error("Not a valid block");if(i===t&&"children"in e&&Array.isArray(e.children)&&r){let t=!1,l=e.children.map(e=>{let{_type:r}=e;if("value"in e&&"span"!==r){t=!0;let{value:r,_key:i,_type:l,__inline:o,children:a,...s}=e;return eM({...s,...r,_key:i,_type:l},n)}return e});return t?eM({...e,children:l,_key:r,_type:i},n):e}let l="value"in e&&e.value;return eM({_key:r,_type:i,..."object"==typeof l?l:{}},n)})}function eT(e,t){var n;return void 0===e||e&&Array.isArray(e)&&0===e.length||e&&Array.isArray(e)&&1===e.length&&w.W_.isElement(e[0])&&e[0]._type===t.block.name&&"style"in e[0]&&e[0].style===t.styles[0].value&&!("listItem"in e[0])&&Array.isArray(e[0].children)&&1===e[0].children.length&&w.xv.isText(e[0].children[0])&&"span"===e[0].children[0]._type&&!(null==(n=e[0].children[0].marks)?void 0:n.join(""))&&""===e[0].children[0].text}let eD=ei("operationToPatches");function eA(e,t,n){let r;let i=[e.path[0]];if(!t)return null;let l=t[i[0]];if(!l)return null;let o=[{_key:l._key}];if(l._type!==n.block.name)return o;let a=e.path.slice(0,2),s=Array.isArray(l.children)&&l.children[a[1]];return s&&(r=["children",{_key:s._key}]),r?[...o,...r]:o}function eC(e,t){if(!t)return[];let[n,r]=Array.from(w.ML.nodes(t,{at:[],match:t=>(0,B.Fd)(e.path[0])&&t._key===e.path[0]._key}))[0]||[void 0,void 0];if(!n||!w.W_.isElement(n))return[];if(t.isVoid(n))return r;let i=[e.path[2]],l=n.children.findIndex(e=>I()([{_key:e._key}],i));if(l>=0&&n.children[l]){let e=n.children[l];return w.W_.isElement(e)&&t.isVoid(e)?r.concat(l).concat(0):r.concat(l)}return r}function eS(e,t,n){if(!t)return null;let r=null,i=null,l=t.anchor&&eA(t.anchor,e,n);l&&t.anchor&&(r={path:l,offset:t.anchor.offset});let o=t.focus&&eA(t.focus,e,n);return o&&t.focus&&(i={path:o,offset:t.focus.offset}),r&&i?{anchor:r,focus:i}:null}function eL(e,t){if(!e||!t)return null;let n={path:eC(e.anchor,t),offset:e.anchor.offset},r={path:eC(e.focus,t),offset:e.focus.offset};return n&&r?{anchor:n,focus:r}:null}let eP=ei("API:editable"),eR=new WeakMap;function eI(e,t){eR.set(e,!0),t(),eR.set(e,!1)}let eB=new WeakMap;function ej(e,t){let n=eB.get(e);eB.set(e,!1),t(),eB.set(e,n)}let eO="before",eY="after";function eW(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((e,t)=>e.concat(t),[])}let ez=Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty),eJ={replace:(e,t)=>t,set:(e,t)=>t,setIfMissing:(e,t)=>void 0===e?t:e,unset(e,t){},inc:(e,t)=>e+t,dec:(e,t)=>e-t},eV=Object.keys(eJ),eF=new em.diff_match_patch,eU={replace:(e,t)=>t,set:(e,t)=>t,setIfMissing:(e,t)=>void 0===e?t:e,unset(e,t){},diffMatchPatch:(e,t)=>eF.patch_apply(eF.patch_fromText(t),e)[0]},e$=Object.keys(eU),eH=ei("patchToOperations"),eq=new em.diff_match_patch;function eZ(e){return"object"==typeof e&&"_key"in e}function eG(e){let t=null;return e.concat("").reverse().forEach(e=>{eZ(e)&&(t=e._key)}),t}function eK(e,t){eH("Children ".concat(t,":"),JSON.stringify(e.children,null,2)),eH("Selection ".concat(t,": "),JSON.stringify(e.selection,null,2))}let eX=ei("plugin:withUndoRedo"),eQ=new em.diff_match_patch,e0=new WeakMap,e1=new WeakMap,e2=e=>e1.get(e),e3=e=>!!eB.get(e)&&e0.get(e);function e6(e,t,n){let r={...n};if("insert"===t.type&&1===t.path.length)return[e4(e,t,n,t.items.length)];if("unset"===t.type&&1===t.path.length)return[e4(e,t,n,-1)];if("unset"===t.type&&0===t.path.length)return eX("Adjusting selection for unset everything patch and ".concat(n.type," operation")),[n];if("diffMatchPatch"===t.type){let i=e.children.findIndex(e=>I()({_key:e._key},t.path[0])),l=e.children[i];if(w.W_.isElement(l)&&Array.isArray(l.children)){let e=l.children.findIndex(e=>I()({_key:e._key},t.path[2])),o=eQ.patch_fromText(t.value)[0];if(!o)return eX("Could not parse diffMatchPatch",t),[n];let a=o.length2-o.length1,s=o.diffs.some(e=>-1===e[0]);if("split_node"===n.type&&n.path.length>1){let e=r;return s?e.position-=a:e.position+=a,[e]}if(("insert_text"===n.type||"remove_text"===n.type)&&w.y$.isPath(n.path)&&void 0!==n.path[0]&&n.path[0]===i&&n.path[1]===e){if("insert_text"===n.type){let e=0;for(let t of o.diffs)if(0===t[0]&&(e=t[1].length),1===t[0])break;if(null!==o.start1&&e+o.start1<=n.offset){let e=r;e.offset+=a,r=e}return[r]}if("remove_text"===n.type){let e=0;for(let t of o.diffs)if(0===t[0]&&(e=t[1].length),-1===t[0])break;if(null!==o.start1&&e+o.start1<=n.offset){let e=r;e.offset-=a,r=e}return[r]}}}}return[n]}function e4(e,t,n,r){let i=e.children.findIndex(e=>I()({_key:e._key},t.path[0]));if(i>=0&&"set_selection"!==n.type&&Array.isArray(n.path)&&void 0!==n.path[0]&&n.path[0]>=i+r){let e={...n},i=[n.path[0]+r,...n.path.slice(1)];return eX("Adjusting ".concat(n.type," for block ").concat(t.type),n.path,i),e.path=i,e}return n}let e5=(e,t)=>!!("set_selection"===e.type||t&&"insert_text"===e.type&&"insert_text"===t.type&&e.offset===t.offset+t.text.length&&w.y$.equals(e.path,t.path)&&" "!==e.text||t&&"remove_text"===e.type&&"remove_text"===t.type&&e.offset+e.text.length===t.offset&&w.y$.equals(e.path,t.path)),e7=(e,t)=>"set_selection"!==e.type||null!==e.newProperties,e9=(e,t)=>!!t&&"set_selection"===e.type&&"set_selection"===t.type,e8=e=>"set_selection"!==e.type;function te(e,t){let n=e3(e);e0.set(e,!1),t(),e0.set(e,n)}let tt=ei("plugin:withPatches"),tn=ei("plugin:withPlaceholderBlock"),tr=ei("plugin:withPortableTextBlockStyle"),ti=ei("plugin:withPortableTextLists"),tl=ei("plugin:withPortableTextMarkModel"),to=ei("plugin:withPortableTextSelections"),ta=ei("plugin:withSchemaTypes"),ts=ei("plugin:withUtils"),tc=ei("plugin:withHotKeys"),th={marks:{"mod+b":"strong","mod+i":"em","mod+u":"underline","mod+'":"code"},custom:{}};function tf(e,t,n){let r=null,i=!0,l=[t.span.name,...t.inlineObjects.map(e=>e.name)],o=[t.block.name,...t.blockObjects.map(e=>e.name)];return void 0===e?{valid:!0,resolution:null,value:e}:Array.isArray(e)&&0!==e.length?(e.some((e,a)=>{if(!O()(e))return r={patches:[ex([a])],description:"Block must be an object, got ".concat(String(e)),action:"Unset invalid item",item:e},!0;if(!e._key)return r={patches:[eb({...e,_key:n()},[a])],description:"Block at index ".concat(a," is missing required _key."),action:"Set the block with a random _key value",item:e},!0;if(!e._type||!o.includes(e._type)){if("block"===e._type){let n=t.block.name;return r={patches:[eb({...e,_type:n},[{_key:e._key}])],description:"Block with _key '".concat(e._key,"' has invalid type name '").concat(e._type,"'. According to the schema, the block type name is '").concat(n,"'"),action:"Use type '".concat(n,"'"),item:e},!0}return r={patches:[ex([{_key:e._key}])],description:"Block with _key '".concat(e._key,"' has invalid _type '").concat(e._type,"'"),action:"Remove the block",item:e},!0}if(e._type===t.block.name){if(!e.children)return r={patches:[ex([{_key:e._key}])],description:"Text block with _key '".concat(e._key,"' is missing required key 'children'."),action:"Remove the block",item:e},!0;if(!e.markDefs)return r={patches:[eb({...e,markDefs:[]},[{_key:e._key}])],description:"Block is missing required key 'markDefs'.",action:"Add empty markDefs array",item:e},!0;let o=q()(P()(e.children.filter(e=>e._type===t.span.name).map(e=>e.marks||[]))),a=o.filter(e=>!t.decorators.map(e=>e.value).includes(e)),s=a.filter(t=>!!e.markDefs&&!e.markDefs.find(e=>e._key===t));if(s.length>0){let n=e.children.filter(e=>e._type===t.span.name&&Array.isArray(e.marks)&&e.marks.some(e=>s.includes(e)));if(n)return r={patches:n.map(t=>eb((t.marks||[]).filter(e=>!s.includes(e)),[{_key:e._key},"children",{_key:t._key},"marks"])),description:"Block with _key '".concat(e._key,"' contains marks (").concat(s.join(", "),") not supported by the current content model."),action:"Remove invalid marks",item:e},!0}if(e.children&&0===e.children.length){let i={_type:t.span.name,_key:n(),text:""};return r={patches:[e_([i],"after",[{_key:e._key},"children",0])],description:"Children for text block with _key '".concat(e._key,"' is empty."),action:"Insert an empty text",item:e},!0}e.children.some((i,o)=>{if(!i._key){let t={...i,_key:n()};return r={patches:[eb(t,[{_key:e._key},"children",o])],description:"Child at index ".concat(o," is missing required _key in block with _key ").concat(e._key,"."),action:"Set a new random _key on the object",item:e},!0}return i._type&&!1!==l.includes(i._type)?i._type===t.span.name&&void 0===i.text&&(r={patches:[eb({...i,text:""},[{_key:e._key},"children",{_key:i._key}])],description:"Child with _key '".concat(i._key,"' in block with key '").concat(e._key,"' is missing text property!"),action:"Write an empty .text to the object",item:e},!0):(r={patches:[ex([{_key:e._key},"children",{_key:i._key}])],description:"Child with _key '".concat(i._key,"' in block with key '").concat(e._key,"' has invalid '_type' property (").concat(i._type,")."),action:"Remove the object",item:e},!0)})&&(i=!1)}return!1})&&(i=!1),{valid:i,resolution:r,value:e}):{valid:!1,resolution:{patches:[ex([])],description:"Editor value must be an array of Portable Text blocks, or undefined.",action:"Unset the value",item:e},value:e}}let td=ei("plugin:withInsertData"),tp={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function tu(e,t,n){if(!e.selection)return;let[r,i]=w.ML.node(e,e.selection,{depth:1});if(e.isTextBlock(r)&&e.isTextBlock(t[0])){let{markDefs:n}=r;td("Mixing markDefs of focusBlock and fragments[0] block",n,t[0].markDefs),I()(n,t[0].markDefs)||w.YR.setNodes(e,{markDefs:q()([...t[0].markDefs||[],...n||[]])},{at:i,mode:"lowest",voids:!1})}let l=eT(e.children,n);l?(w.YR.splitNodes(e,{at:[0,0]}),e.insertFragment(t),w.YR.removeNodes(e,{at:[0]})):e.insertFragment(t),e.onChange()}let tg=new WeakMap,tm=(e,t)=>{var n;let r;let i=e,{keyGenerator:l,portableTextEditor:o,patches$:a,readOnly:s,maxBlocks:c,isPending:h}=t,{schemaTypes:y,change$:k}=o;i.subscriptions=[],i.destroy?i.destroy():tg.set(i,{apply:i.apply,onChange:i.onChange,normalizeNode:i.normalizeNode});let v=function(e){let t=e.block.name;return{insertNodePatch:function(e,n,r){let i=r[n.path[0]],l=e.isTextBlock(i);if(1===n.path.length){let e=0===n.path[0]?"before":"after",l=r[n.path[0]-1],o=0===n.path[0]?null==i?void 0:i._key:null==l?void 0:l._key;return o?[e_([eN([n.node],t)[0]],e,[{_key:o}])]:[ey(r,[]),e_([eN([n.node],t)[0]],"before",[n.path[0]])]}if(l&&2===n.path.length&&e.children[n.path[0]]){let e=0!==i.children.length&&i.children[n.path[1]-1]?"after":"before",r=eN([{_key:"bogus",_type:t,children:[n.node]}],t)[0],l=r.children[0];return[e_([l],e,[{_key:i._key},"children",i.children.length<=1||!i.children[n.path[1]-1]?0:{_key:i.children[n.path[1]-1]._key}])]}return eD("Something was inserted into a void block. Not producing editor patches."),[]},insertTextPatch:function(e,t,n){eD("Operation",JSON.stringify(t,null,2));let r=e.isTextBlock(e.children[t.path[0]])&&e.children[t.path[0]];if(!r)throw Error("Could not find block");let i=e.isTextBlock(r)&&e.isTextSpan(r.children[t.path[1]])&&r.children[t.path[1]];if(!i)throw Error("Could not find child");let l=[{_key:r._key},"children",{_key:i._key},"text"],o=n[t.path[0]],a=e.isTextBlock(o)&&o.children[t.path[1]],s=e.isTextSpan(a)?a.text:"",c=ev(s,i.text,l);return c.value.length?[c]:[]},mergeNodePatch:function(e,n,r){let i=[],l=r[n.path[0]],o=e.children[n.path[0]];if(1===n.path.length){if(null==l?void 0:l._key){let r=eN([e.children[n.path[0]-1]],t)[0];i.push(eb(r,[{_key:r._key}])),i.push(ex([{_key:l._key}]))}else throw Error("Target key not found!")}else if(2===n.path.length&&e.isTextBlock(o)){let t=e.isTextBlock(l)&&l.children[n.path[1]]||void 0,r=o.children[n.path[1]-1];e.isTextSpan(r)&&(i.push(eb(r.text,[{_key:l._key},"children",{_key:r._key},"text"])),t&&i.push(ex([{_key:l._key},"children",{_key:t._key}])))}else eD("Void nodes can't be merged, not creating any patches");return i},moveNodePatch:function(e,n,r){let i=[],l=r[n.path[0]],o=r[n.newPath[0]];if(1===n.path.length){let e=n.path[0]>n.newPath[0]?"before":"after";i.push(ex([{_key:l._key}])),i.push(e_([eN([l],t)[0]],e,[{_key:o._key}]))}else if(2===n.path.length&&e.isTextBlock(l)&&e.isTextBlock(o)){let e=l.children[n.path[1]],r=o.children[n.newPath[1]],a=n.newPath[1]===o.children.length?"after":"before",s=eN([l],t)[0].children[n.path[1]];i.push(ex([{_key:l._key},"children",{_key:e._key}])),i.push(e_([s],a,[{_key:o._key},"children",{_key:r._key}]))}return i},removeNodePatch:function(e,t,n){let r=n[t.path[0]];if(1===t.path.length){if(r&&r._key)return[ex([{_key:r._key}])];throw Error("Block not found")}if(!e.isTextBlock(r)||2!==t.path.length)return eD("Not creating patch inside object block"),[];{let n=e.isTextBlock(r)&&r.children&&r.children[t.path[1]];return n?[ex([{_key:r._key},"children",{_key:n._key}])]:(eD("Span not found in editor trying to remove node"),[])}},removeTextPatch:function(e,t,n){let r=e&&e.children[t.path[0]];if(!r)throw Error("Could not find block");let i=e.isTextBlock(r)&&r.children[t.path[1]]||void 0,l=e.isTextSpan(i)?i:void 0;if(i&&!l)throw Error("Expected span");if(!l)throw Error("Could not find child");let o=[{_key:r._key},"children",{_key:l._key},"text"],a=n[t.path[0]],s=e.isTextBlock(a)&&a.children[t.path[1]],c=e.isTextSpan(s)&&s.text,h=ev(c||"",l.text,o);return h.value?[h]:[]},setNodePatch:function(e,n){if(1===n.path.length){let r=e.children[n.path[0]];if("string"!=typeof r._key)throw Error("Expected block to have a _key");let i=T()({...e.children[n.path[0]],...n.newProperties},A());return[eb(eN([i],t)[0],[{_key:r._key}])]}if(2===n.path.length){let t=e.children[n.path[0]];if(e.isTextBlock(t)){let e=t.children[n.path[1]];if(e){let r=t._key,i=e._key,l=[];return Object.keys(n.newProperties).forEach(e=>{let t=S()(n.newProperties,e);l.push(eb(t,[{_key:r},"children",{_key:i},e]))}),l}throw Error("Could not find a valid child")}throw Error("Could not find a valid block")}throw Error("Unexpected path encountered: ".concat(JSON.stringify(n.path)))},splitNodePatch:function(e,n,r){let i=[],l=e.children[n.path[0]];if(!e.isTextBlock(l))throw Error("Block with path ".concat(JSON.stringify(n.path[0])," is not a text block and can't be split"));if(1===n.path.length){let o=r[n.path[0]];if(e.isTextBlock(o)){let r=eN([e.children[n.path[0]+1]],t)[0];if(r){i.push(e_([r],"after",[{_key:l._key}]));let e=o.children.slice(n.position);e.forEach(e=>{let t=[{_key:o._key},"children",{_key:e._key}];i.push(ex(t))})}}return i}if(2===n.path.length){let r=l.children[n.path[1]];if(e.isTextSpan(r)){let e=eN([{...l,children:l.children.slice(n.path[1]+1,n.path[1]+2)}],t)[0].children;i.push(e_(e,"after",[{_key:l._key},"children",{_key:r._key}])),i.push(eb(r.text,[{_key:l._key},"children",{_key:r._key},"text"]))}}return i}}}(y),_=function(e){eR.set(e,!1);let{apply:t,normalizeNode:n}=e;return e.apply=n=>{if("split_node"===n.type&&(n.properties={...n.properties,_key:l()}),"insert_node"===n.type){let t=!eR.get(e)||!("_key"in n.node);w.ML.isEditor(n.node)||(n.node={...n.node,...t?{_key:l()}:{}})}t(n)},e.normalizeNode=t=>{let[r,i]=t;if(w.W_.isElement(r)&&r._type===y.block.name){for(let[t,n]of(r._key||w.YR.setNodes(e,{_key:l()},{at:i}),w.NB.children(e,i)))if(!t._key){w.YR.setNodes(e,{_key:l()},{at:n});return}}n(t)},e},b=function(e){e.isTextBlock=e=>(0,B.DG)(e)&&e._type===y.block.name,e.isTextSpan=e=>(0,B.NG)(e)&&e._type==y.span.name,e.isListBlock=e=>(0,B.KA)(e)&&e._type===y.block.name,e.isVoid=e=>y.block.name!==e._type&&(y.blockObjects.map(e=>e.name).includes(e._type)||y.inlineObjects.map(e=>e.name).includes(e._type)),e.isInline=e=>{let t=y.inlineObjects.map(e=>e.name);return t.includes(e._type)&&"__inline"in e&&!0===e.__inline};let{apply:t}=e;return e.apply=e=>{let n="insert_node"===e.type&&2===e.path.length&&w.xv.isText(e.node)&&void 0===e.node._type;if(n){let t={...e.node,_type:"span"};e.node=t,ta("Setting span type to child without a type",e)}t(e)},e},M=function(e){return o.setEditable({focus:()=>{if(!e.selection){let t={path:[0,0],offset:0};w.YR.select(e,{focus:t,anchor:t}),e.onChange()}x.F3.focus(e)},blur:()=>{x.F3.blur(e)},toggleMark:t=>{e.pteToggleMark(t)},toggleList:t=>{e.pteToggleListItem(t)},toggleBlockStyle:t=>{e.pteToggleBlockStyle(t)},isMarkActive:t=>{try{return e.pteIsMarkActive(t)}catch(e){return console.warn(e),!1}},marks:()=>({...w.ML.marks(e)||{}}).marks||[],undo:()=>e.undo(),redo:()=>e.redo(),select:t=>{let n=eL(t,e);n?w.YR.select(e,n):w.YR.deselect(e),e.onChange()},focusBlock:()=>{if(e.selection)try{let[t]=Array.from(w.ML.nodes(e,{at:e.selection.focus,match:t=>w.ML.isBlock(e,t)}))[0]||[void 0];if(t)return eN([t],y.block.name,ep.get(e))[0]}catch(e){}},focusChild:()=>{if(e.selection)try{let[t]=Array.from(w.ML.nodes(e,{mode:"lowest",at:e.selection.focus,match:e=>void 0!==e._type,voids:!0}))[0]||[void 0];if(t&&!w.ML.isBlock(e,t)){let n={_key:"pseudo",_type:y.block.name,children:[t]},r=eN([n],y.block.name,ep.get(e));if(e.isTextBlock(r[0]))return r[0].children[0]}}catch(e){}},insertChild:(t,n)=>{var r;if(!e.selection)throw Error("The editor has no selection");let[i]=Array.from(w.ML.nodes(e,{at:e.selection.focus,match:t=>w.ML.isBlock(e,t)}))[0]||[void 0];if(!i)throw Error("No focus block");if(i&&w.ML.isVoid(e,i))throw Error("Can't insert childs into block objects");let a=eE([{_key:l(),_type:y.block.name,children:[{_key:l(),_type:t.name,...n||{}}]}],o)[0],s=a.children[0];return w.ML.insertNode(e,s),e.onChange(),(null==(r=eS(eN(e.children,y.block.name,ep.get(e)),e.selection,y))?void 0:r.focus.path)||[]},insertBlock:(t,n)=>{var r;if(!e.selection)throw Error("The editor has no selection");let i=eE([{_key:l(),_type:t.name,...n||{}}],o)[0];return w.ML.insertNode(e,i),e.onChange(),(null==(r=eS(eN(e.children,y.block.name,ep.get(e)),e.selection,y))?void 0:r.focus.path)||[]},hasBlockStyle:t=>{try{return e.pteHasBlockStyle(t)}catch(e){return!1}},hasListStyle:t=>{try{return e.pteHasListStyle(t)}catch(e){return!1}},isVoid:e=>![y.block.name,y.span.name].includes(e._type),findByPath:t=>{let n=eL({focus:{path:t,offset:0},anchor:{path:t,offset:0}},e);if(n){let[r,i]=w.ML.node(e,n.focus.path.slice(0,1));if(r&&i&&"string"==typeof r._key){if(1===t.length&&1===n.focus.path.length)return[eN([r],y.block.name)[0],[{_key:r._key}]];let i=eN([r],y.block.name,ep.get(e))[0];if(e.isTextBlock(i)){let e=i.children[n.focus.path[1]];if(e)return[e,[{_key:r._key},"children",{_key:e._key}]]}}}return[void 0,void 0]},findDOMNode:t=>{let n;try{let[r]=Array.from(w.ML.nodes(e,{at:[],match:e=>e._key===t._key})||[])[0]||[void 0];n=x.F3.toDOMNode(e,r)}catch(e){}return n},activeAnnotations:()=>{var t;if(!e.selection||e.selection.focus.path.length<2)return[];try{let n=[],r=w.ML.nodes(e,{at:e.selection,match:e=>w.xv.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0});for(let[i,l]of r){let[r]=w.ML.node(e,l,{depth:1});e.isTextBlock(r)&&(null==(t=r.markDefs)||t.forEach(e=>{w.xv.isText(i)&&i.marks&&Array.isArray(i.marks)&&i.marks.includes(e._key)&&n.push(e)}))}return n}catch(e){return[]}},addAnnotation:(t,n)=>{let{selection:r}=e;if(r){let[i]=w.ML.node(e,r.focus,{depth:1});if(w.W_.isElement(i)&&i._type===y.block.name){let o=l();if(e.isTextBlock(i)){w.YR.setNodes(e,{markDefs:[...i.markDefs||[],{_type:t.name,_key:o,...n}]},{at:r.focus}),e.onChange(),w.e6.isCollapsed(r)&&(e.pteExpandToWord(),e.onChange());let[a]=w.ML.node(e,r.focus,{depth:2});if(e.selection){w.ML.withoutNormalizing(e,()=>{w.YR.setNodes(e,{},{match:w.xv.isText,split:!0}),e.selection&&w.xv.isText(a)&&(w.YR.setNodes(e,{marks:[...a.marks||[],o]},{at:e.selection,match:e=>e._type===y.span.name}),e.onChange())}),w.ML.normalize(e),e.onChange();let t=eS(eN(e.children,y.block.name,ep.get(e)),e.selection,y);if(t&&"string"==typeof i._key)return w.ML.withoutNormalizing(e,()=>{e.selection&&(w.YR.insertNodes(e,[{_type:"span",text:"",marks:[],_key:l()}],{at:w.e6.end(e.selection)}),e.onChange())}),{spanPath:t.focus.path,markDefPath:[{_key:i._key},"markDefs",{_key:o}]}}}}}},delete:(t,n)=>{if(t){let r=eL(t,e);if(r){if(!(null==n?void 0:n.mode)||(null==n?void 0:n.mode)==="selected"){eP("Deleting content in selection"),w.YR.delete(e,{at:r,hanging:!0,voids:!0}),e.onChange();return}let t=w.ML.nodes(e,{at:r,match:t=>(null==n?void 0:n.mode)==="blocks"?(eP("Deleting blocks touched by selection"),e.isTextBlock(t)||!e.isTextBlock(t)&&w.W_.isElement(t)):(eP("Deleting children touched by selection"),t._type===y.span.name||!e.isTextBlock(t)&&w.W_.isElement(t))}),i=[...t];i.forEach(t=>{let[,n]=t;w.YR.removeNodes(e,{at:n,voids:!0,hanging:!0})}),e.onChange()}}},removeAnnotation:t=>{let{selection:n}=e;if(eP("Removing annotation",t),n){if(w.e6.isCollapsed(n)){let[t,r]=w.ML.node(e,n,{depth:2});w.xv.isText(t)&&t.marks&&"string"==typeof t.text&&(w.YR.select(e,r),n=e.selection)}w.ML.withoutNormalizing(e,()=>{if(n&&w.e6.isExpanded(n)){if(!(n=e.selection))return;w.YR.setNodes(e,{},{match:w.xv.isText,split:!0}),e.onChange();let r=[...w.ML.nodes(e,{at:n,match:e=>w.xv.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0})];r.forEach(n=>{var r;let[i,l]=n,[o]=w.ML.node(e,l,{depth:1});e.isTextBlock(o)&&(null==(r=o.markDefs)||r.filter(e=>e._type===t.name).forEach(t=>{if(w.xv.isText(i)&&Array.isArray(i.marks)&&i.marks.includes(t._key)){let n=[...(i.marks||[]).filter(e=>e!==t._key)];w.YR.setNodes(e,{marks:n},{at:l,voids:!1,split:!1})}}))})}}),w.ML.normalize(e),e.onChange()}},getSelection:()=>{let t=null;if(e.selection){let n=eu.get(e.selection);if(n)return n;t=eS(eN(e.children,y.block.name,ep.get(e)),e.selection,y),eu.set(e.selection,t)}return t},getValue:()=>eN(e.children,y.block.name,ep.get(e)),isCollapsedSelection:()=>!!e.selection&&w.e6.isCollapsed(e.selection),isExpandedSelection:()=>!!e.selection&&w.e6.isExpanded(e.selection),insertBreak:()=>{e.insertBreak(),e.onChange()}}),e},N=function(e){let t,n,{change$:r,isPending:i,patches$:l,patchFunctions:o,readOnly:a,schemaTypes:s}=e,c=function(e,n){let r=!1;eH("\n\nNEW PATCH ============================================================="),eH(JSON.stringify(n,null,2));try{switch(n.type){case"insert":r=function(e,t){if(1===t.path.length){let{items:n,position:r}=t,i=eE(n,{schemaTypes:s},ed.get(e)),l=eG(t.path),o=Math.max(0,e.children.findIndex((e,n)=>l?e._key===l:n===t.path[0])),a="after"===r?o+1:o;return eH("Inserting blocks at path [".concat(a,"]")),eK(e,"before"),w.YR.insertNodes(e,i,{at:[a]}),eK(e,"after"),!0}let{items:n,position:r}=t,i=eG(t.path),l=e.children.findIndex((e,n)=>i?e._key===i:n===t.path[0]),o=e.children&&l>-1?e.children[l]:void 0,a=e.isTextBlock(o)?o.children.findIndex((e,n)=>eZ(t.path[2])?e._key===t.path[2]._key:n===t.path[2]):0,c=o&&eE([{...o,children:n}],{schemaTypes:s},ed.get(e)),h=[l,"after"===r?a+1:a];return eH("Inserting children at path ".concat(h)),eK(e,"before"),c&&w.W_.isElement(c[0])&&w.YR.insertNodes(e,c[0].children,{at:h}),eK(e,"after"),!0}(e,n);break;case"unset":r=function(e,t,n){var r;if(0===t.path.length){eH("Removing everything"),eK(e,"before");let t=e.selection;return w.YR.deselect(e),e.children.forEach((t,n)=>{w.YR.removeNodes(e,{at:[n]})}),w.YR.insertNodes(e,e.createPlaceholderBlock()),t&&w.YR.select(e,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),eK(e,"after"),!0}if(1===t.path.length){let n=eG(t.path),r=e.children.findIndex((e,r)=>n?e._key===n:r===t.path[0]);if(-1===r)return eH("Could not find block to unset at path ".concat(JSON.stringify(t.path))),!1;if(eH("Removing block at path [".concat(r,"]")),eK(e,"before"),e.selection&&e.selection.focus.path[0]===r&&e.children[r-1]){let t={path:[Math.max(e.selection.focus.path[0]-1,0)],offset:0};w.YR.select(e,{focus:t,anchor:t}),w.YR.move(e,{unit:"line"})}return w.YR.removeNodes(e,{at:[r]}),eK(e,"after"),!0}let i=e.children.findIndex((e,n)=>eZ(t.path[0])?e._key===t.path[0]._key:n===t.path[0]),l=i>-1?e.children[i]:void 0;if(e.isTextBlock(l)&&"children"===t.path[1]&&3===t.path.length){let o=l.children.findIndex((e,n)=>eZ(t.path[2])?e._key===t.path[2]._key:n===t.path[2]),a=[i,o],s=e.selection&&{...e.selection},c=I()(null==(r=e.selection)?void 0:r.focus.path,a);if(-1===o)return eH("Could not find child to unset at path ".concat(JSON.stringify(a))),!1;if(eH("Unsetting child at path ".concat(JSON.stringify(a))),eK(e,"before"),s&&c&&e.isTextBlock(l)){let t=o>=s.focus.path[1];if(t){let t=l.children[o],r=(null==n?void 0:n.type)==="set"&&"text"===n.path[3]&&"string"==typeof n.value&&e.isTextSpan(t)&&I()(n.value.slice(-t.text.length),l.children[o].text);if(r){let n=l.children[Math.max(o-1,0)];return eH("Adjusting selection for merging of nodes"),s.focus={...s.focus},s.focus.path=[a[0],Math.max(a[1]-1,0)],s.focus.offset=e.isTextSpan(n)?n.text.length-t.text.length+s.focus.offset:0,s.anchor=s.focus,w.YR.select(e,s),w.YR.removeNodes(e,{at:[i,o]}),eK(e,"after"),!0}}}return w.YR.removeNodes(e,{at:[i,o]}),eK(e,"after"),!0}return!1}(e,n,t);break;case"set":r=function(e,t){let n=e.children.findIndex((e,n)=>eZ(t.path[0])?e._key===t.path[0]._key:n===t.path[0]);eH("blockIndex",n);let r=n>-1?e.children[n]:void 0,i=e.isTextBlock(r);if(i&&t.path.length>2&&"children"!==t.path[1])return eH("Ignoring setting void value"),!1;let l=i?r.children.findIndex((e,n)=>eZ(t.path[2])?e._key===t.path[2]._key:n===t.path[2]):0,o=t.value,a=l>-1?[n,l]:[n];if("string"==typeof t.path[3]&&((o={})[t.path[3]]=t.value),i){if(eH("Setting nodes at ".concat(JSON.stringify(t.path)," - ").concat(JSON.stringify(a))),eH("Value to set",JSON.stringify(o,null,2)),eK(e,"before"),1===a.length){eH("Setting block property");let{children:t,...n}=o,{children:i,...l}=r||{children:void 0};e.apply({type:"set_node",path:a,properties:{...l},newProperties:n}),r&&w.W_.isElement(r)&&r.children.forEach((t,n)=>{e.apply({type:"remove_node",path:a.concat(n),node:t})}),Array.isArray(t)&&t.forEach((t,n)=>{e.apply({type:"insert_node",path:a.concat(n),node:t})})}else if(w.xv.isText(o)){eH("Setting text property");let t=e.selection&&{...e.selection};e.apply({type:"remove_text",path:a,offset:0,text:r.children[l].text}),e.apply({type:"insert_text",path:a,offset:0,text:o.text});let n=t&&I()(t.focus.path,a);n&&(eH("On same path, restoring previous selection"),w.YR.select(e,t))}else eH("Setting non-text property"),e.apply({type:"set_node",path:a,properties:{},newProperties:o});return eK(e,"after"),!0}if(r&&"value"in r){var s;let i=(s=[r.value],[t].reduce(function e(t,n){let r=Array.isArray(t)?function(t,n){let r=t.slice();if(0===n.path.length){if("setIfMissing"===n.type){if(!Array.isArray(n.value))throw Error("Cannot set value of an array to a non-array");return void 0===t?n.value:t}if("set"===n.type){if(!Array.isArray(n.value))throw Error("Cannot set value of an array to a non-array");return n.value}if("unset"===n.type)return;if("move"===n.type){if(!n.value||!ez(n.value,"from")||!ez(n.value,"to"))throw Error('Invalid value of \'move\' patch. Expected a value with "from" and "to" indexes, instead got: '.concat(JSON.stringify(n.value)));return function(e,t,n){let r=e.slice(),i=r[t];return r.splice(t,1),r.splice(n,0,i),r}(r,n.value.from,n.value.to)}throw Error("Invalid array operation: ".concat(n.type))}let[i,...l]=n.path,o=function(e,t){if("number"==typeof t)return t;let n=J()(e,t);return -1!==n&&n}(t,i);if(!1===o)return r;if(0===l.length){if("insert"===n.type){let{position:e,items:r}=n;return function(e,t,n){if(t!==eO&&t!==eY)throw Error('Invalid position "'.concat(t,'", must be either ').concat(eO," or ").concat(eY));for(var r=arguments.length,i=Array(r>3?r-3:0),l=3;l<r;l++)i[l-3]=arguments[l];let o=eW(...i);if(0===e.length)return o;let a=e.length,s=Math.abs((a+n)%a)%a,c=e.slice();return c.splice("after"===t?s+1:s,0,...eW(o)),c}(t,e,o,r)}if("unset"===n.type){if("number"!=typeof o)throw Error('Expected array index to be a number, instead got "'.concat(o,'"'));return r.splice(o,1),r}}return r[o]=e(r[o],{...n,path:l}),r}(t,n):W()(t)?function(e,t){if(!e$.includes(t.type))throw Error('Received patch of unsupported type: "'.concat(JSON.stringify(t.type),'" for string. This is most likely a bug.'));if(t.path.length>0)throw Error('Cannot apply deep operations on string values. Received patch with type "'.concat(t.type,'" and path "').concat(t.path.join("."),' that targeted the value "').concat(JSON.stringify(e),'"'));let n=eU[t.type];if(n)return n(e,t.value);throw Error("Unknown patch type")}(t,n):O()(t)?function(t,n){let r=$()(t);if(0===n.path.length){if("set"===n.type){if(!O()(n.value))throw Error("Cannot set value of an object to a non-object");return n.value}if("unset"===n.type)return;if("setIfMissing"===n.type)return void 0===t?n.value:t;throw Error("Invalid object operation: ".concat(n.type))}let[i,...l]=n.path;if("string"!=typeof i)throw Error("Expected field name to be a string, instad got: ".concat(i));return 0===l.length&&"unset"===n.type?F()(r,i):(r[i]=e(r[i],{...n,path:l}),r)}(t,n):function(e,t){if(!eV.includes(t.type))throw Error('Received patch of unsupported type: "'.concat(JSON.stringify(t.type),'" for primitives. This is most likely a bug.'));if(t.path.length>0)throw Error('Cannot apply deep operations on primitive values. Received patch with type "'.concat(t.type,'" and path "').concat(t.path.map(e=>JSON.stringify(e)).join("."),' that targeted the value "').concat(JSON.stringify(e),'"'));return eJ[t.type](e,t.value)}(t,n);return r},s))[0];return w.YR.setNodes(e,{...r,value:i},{at:[n]}),!0}return!1}(e,n);break;case"diffMatchPatch":r=function(e,t){let n=eG([t.path[0]]),r=e.children.findIndex((e,r)=>n?e._key===n:r===t.path[0]),i=e.children[r],l=eq.patch_fromText(t.value)[0],o=e.isTextBlock(i)&&"children"===t.path[1]&&4===t.path.length&&"text"===t.path[3];if(l&&o){let n;let o=l.length2-l.length1;if(n=l.diffs[1]?l.diffs[1][1]:l.diffs[0][1],"children"===t.path[1]){let a=eG([t.path[2]]),s=i.children.findIndex((e,n)=>a?e._key===a:n===t.path[0]),c=[r];s>-1&&c.push(s);let h={path:c,offset:o>=0?(l.start1||0)+l.diffs[0][1].length:(l.start2||0)+l.length2-o};eK(e,"before"),o>=0?e.apply({type:"insert_text",path:h.path,offset:h.offset,text:n}):e.apply({type:"remove_text",path:h.path,offset:h.offset-n.length,text:n})}return eK(e,"after"),!0}return!1}(e,n);break;default:eH("Unhandled patch",n.type)}}catch(e){console.error(e)}return t=n,r};return function(e){eB.set(e,!0),n=[...e.children];let{apply:t}=e;return l&&e.subscriptions.push(()=>{var t;tt("Subscribing to patches$");let n=l.pipe((0,d.b)(e=>{let{patches:t}=e;t.every(e=>"local"===e.origin)&&(i.current=!1)}),(t=()=>!i.current,e=>(0,f.P)(()=>{let n=[];return e.pipe((0,d.b)(e=>n.push(e)),(0,p.w)(()=>t(n)?(0,u.of)(n):g.E),(0,d.b)(()=>n=[]))})),(0,m.b)(e=>e)).subscribe(t=>{let{patches:n,snapshot:r}=t,i=n.filter(e=>"local"!==e.origin);0!==i.length&&(tt("Remote patches",n),w.ML.withoutNormalizing(e,()=>{i.forEach(t=>{tt("Handling remote patch ".concat(JSON.stringify(t))),ej(e,()=>{te(e,()=>{eI(e,()=>{try{c(e,t,n,r)}catch(e){tt("Got error trying to create operations from patch"),console.error(e)}})})})})}))});return()=>{tt("Unsubscribing to patches$"),n.unsubscribe()}}),e.apply=i=>{if(a)return t(i),e;let l=[];n=e.children;let c=eT(n,s);t(i);let h=eT(e.children,s);if(!eB.get(e))return tt("Editor is not producing patch for operation ".concat(i.type),i),e;switch(c&&!h&&"set_selection"!==i.type&&l.push(e_(n,"before",[0])),i.type){case"insert_text":l=[...l,...o.insertTextPatch(e,i,n)];break;case"remove_text":l=[...l,...o.removeTextPatch(e,i,n)];break;case"remove_node":l=[...l,...o.removeNodePatch(e,i,n)];break;case"split_node":l=[...l,...o.splitNodePatch(e,i,n)];break;case"insert_node":l=[...l,...o.insertNodePatch(e,i,n)];break;case"set_node":l=[...l,...o.setNodePatch(e,i,n)];break;case"merge_node":l=[...l,...o.mergeNodePatch(e,i,n)];break;case"move_node":l=[...l,...o.moveNodePatch(e,i,n)]}return!c&&h&&["merge_node","set_node","remove_text","remove_node"].includes(i.type)&&(l=[...l,ex([])],r.next({type:"unset",previousValue:eN(n,s.block.name,ep.get(e))})),c&&l.length>0&&(l=[ey([],[]),...l]),l.length>0&&l.forEach(e=>{r.next({type:"patch",patch:{...e,origin:"local"}})}),e},e}}({change$:k,isPending:h,keyGenerator:l,patches$:a,patchFunctions:v,readOnly:s,schemaTypes:y}),D=(n=c||-1,function(e){let{apply:t}=e;return e.apply=r=>{n>0&&e.children.length>=n&&("insert_node"===r.type||"split_node"===r.type)&&1===r.path.length||t(r)},e}),C=function(e){return e.pteToggleListItem=t=>{let n=e.pteHasListStyle(t);n?(ti("Remove list item '".concat(t,"'")),e.pteUnsetListItem(t)):(ti("Add list item '".concat(t,"'")),e.pteSetListItem(t))},e.pteUnsetListItem=t=>{if(!e.selection)return;let n=[...w.ML.nodes(e,{at:e.selection,match:e=>w.W_.isElement(e)&&e._type===y.block.name})];n.forEach(n=>{let[r,i]=n;if(e.isListBlock(r)){let{listItem:n,level:l,...o}=r,a={...o,listItem:void 0,level:void 0};ti("Unsetting list '".concat(t,"'")),w.YR.setNodes(e,a,{at:i})}})},e.pteSetListItem=t=>{if(!e.selection)return;let n=[...w.ML.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})];n.forEach(n=>{let[r,i]=n;ti("Setting list '".concat(t,"'")),w.YR.setNodes(e,{...r,level:1,listItem:t||y.lists[0]&&y.lists[0].value},{at:i})})},e.pteEndList=()=>{if(!e.selection)return!1;let t=[...w.ML.nodes(e,{at:e.selection,match:t=>w.W_.isElement(t)&&e.isListBlock(t)&&1===t.children.length&&w.xv.isText(t.children[0])&&""===t.children[0].text})];return 0!==t.length&&(t.forEach(t=>{let[n,r]=t;w.W_.isElement(n)&&(ti("Unset list"),w.YR.setNodes(e,{...n,level:void 0,listItem:void 0},{at:r}))}),!0)},e.pteIncrementBlockLevels=t=>{if(!e.selection)return!1;let n=[...w.ML.nodes(e,{at:e.selection,match:t=>!!e.isListBlock(t)})];return 0!==n.length&&(n.forEach(n=>{let[r,i]=n;if(e.isListBlock(r)){let n=r.level||1;t?ti("Decrementing list level",Math.min(10,Math.max(1,--n))):ti("Incrementing list level",Math.min(10,Math.max(1,++n))),w.YR.setNodes(e,{level:Math.min(10,Math.max(1,n))},{at:i})}}),!0)},e.pteHasListStyle=t=>{if(!e.selection)return!1;let n=[...w.ML.nodes(e,{at:e.selection,match:n=>e.isListBlock(n)&&n.listItem===t})];return n.length>0},e},L=function(e){let{readOnly:t,patches$:n}=e,r=[];return e=>{n&&e.subscriptions.push(()=>{eX("Subscribing to patches");let e=n.subscribe(e=>{let{patches:t}=e;t.forEach(e=>{"local"!==e.origin&&r.push({patch:e,time:new Date})})});return()=>{eX("Unsubscribing to patches"),e.unsubscribe()}}),e.history={undos:[],redos:[]};let{apply:i}=e;return e.apply=n=>{if(t){i(n);return}let{operations:r,history:l}=e,{undos:o}=l,a=o[o.length-1],s=a&&a.operations&&a.operations[a.operations.length-1],c=e9(n,s),h=e3(e),f=e2(e);if(null==h&&(h=e7(n)),h){if(null==f&&(f=null!=a&&(0!==r.length||e5(n,s)||c)),a&&f)c&&a.operations.pop(),a.operations.push(n);else{let t={operations:[...null===e.selection?[]:[{type:"set_selection",properties:{...e.selection},newProperties:{...e.selection}}],n],timestamp:new Date};o.push(t),eX("Created new undo step",a)}for(;o.length>300;)o.shift();e8(n)&&(l.redos=[])}i(n)},e.undo=()=>{if(t)return;let{undos:n}=e.history;if(n.length>0){let t=n[n.length-1];if(eX("Undoing",t),t.operations.length>0){let n=[...r.filter(e=>e.time>=t.timestamp)],i=t.operations;n.forEach(t=>{i=P()(i.map(n=>e6(e,t.patch,n)))}),te(e,()=>{w.ML.withoutNormalizing(e,()=>{i.map(w.OX.inverse).reverse().forEach(n=>{try{e.apply(n)}catch(n){eX("Could not perform undo step",n),e.history.redos.push(t),e.history.undos.pop()}})})})}e.history.redos.push(t),e.history.undos.pop(),e.onChange()}},e.redo=()=>{if(t)return;let{redos:n}=e.history;if(n.length>0){let t=n[n.length-1];if(eX("Redoing",t),t.operations.length>0){let n=r.filter(e=>e.time>t.timestamp),i=t.operations;n.forEach(t=>{i=P()(i.map(n=>e6(e,t.patch,n)))}),te(e,()=>{w.ML.withoutNormalizing(e,()=>{i.forEach(n=>{try{e.apply(n)}catch(n){eX("Could not perform redo step",n),e.history.undos.push(t),e.history.redos.pop()}})})})}e.history.undos.push(t),e.history.redos.pop(),e.onChange()}},e}}({readOnly:s,patches$:a}),R=function(e){let{apply:t,normalizeNode:n}=e,r=y.decorators.map(e=>e.value);return e.normalizeNode=t=>{n(t),e.operations.some(e=>["insert_node","insert_text","merge_node","remove_node","remove_text","set_node"].includes(e.type))&&function(e){let{selection:t}=e;if(t)for(let[n,r]of Array.from(w.ML.nodes(e,{at:w.ML.range(e,[t.anchor.path[0]],[t.focus.path[0]])})).reverse()){let[t]=r.length>1?w.ML.node(e,w.y$.parent(r)):[void 0],i=[r[0],r[1]+1];if(w.ML.isBlock(e,t)){let r=t.children[i[1]];w.xv.isText(n)&&w.xv.isText(r)&&I()(r.marks,n.marks)&&(tl("Merging spans"),w.YR.mergeNodes(e,{at:i,voids:!0}),e.onChange())}}}(e);let[r,i]=t,l=w.xv.isText(r)&&r._type===y.span.name,o=e.isTextBlock(r);if(l||o){for(let t of(l&&!Array.isArray(r.marks)&&(tl("Adding .marks to span node"),w.YR.setNodes(e,{marks:[]},{at:i}),e.onChange()),e.operations)){if("merge_node"===t.type&&1===t.path.length&&"markDefs"in t.properties&&t.properties._type===y.block.name&&Array.isArray(t.properties.markDefs)&&t.properties.markDefs.length>0&&t.path[0]-1>=0){let[n,r]=w.ML.node(e,[t.path[0]-1]);if(tl("Copying markDefs over to merged block",t),e.isTextBlock(n)){let i=Array.isArray(n.markDefs)&&n.markDefs||[],l=q()([...i,...t.properties.markDefs]),o=I()(l,n.markDefs);o||(w.YR.setNodes(e,{markDefs:l},{at:r,voids:!1}),e.onChange())}}if("split_node"===t.type&&1===t.path.length&&w.W_.isElementProps(t.properties)&&t.properties._type===y.block.name&&"markDefs"in t.properties&&Array.isArray(t.properties.markDefs)&&t.properties.markDefs.length>0&&t.path[0]+1<e.children.length){let[n,r]=w.ML.node(e,[t.path[0]+1]);if(tl("Copying markDefs over to split block",t),e.isTextBlock(n)){let i=Array.isArray(n.markDefs)&&n.markDefs||[];w.YR.setNodes(e,{markDefs:q()([...i,...t.properties.markDefs])},{at:r,voids:!1}),e.onChange()}}if("split_node"===t.type&&2===t.path.length&&t.properties._type===y.span.name&&"marks"in t.properties&&Array.isArray(t.properties.marks)&&t.properties.marks.length>0&&t.path[0]+1<e.children.length){let[n,r]=w.ML.node(e,[t.path[0]+1,0]);w.xv.isText(n)&&""===n.text&&Array.isArray(n.marks)&&n.marks.length>0&&(w.YR.setNodes(e,{marks:[]},{at:r,voids:!1}),e.onChange())}if("split_node"===t.type&&1===t.path.length&&t.properties._type===y.block.name&&"markDefs"in t.properties&&Array.isArray(t.properties.markDefs)&&t.properties.markDefs.length>0){let[n,r]=w.ML.node(e,[t.path[0]]);e.isTextBlock(n)&&1===n.children.length&&n.markDefs&&n.markDefs.length>0&&w.xv.isText(n.children[0])&&""===n.children[0].text&&(!n.children[0].marks||0===n.children[0].marks.length)&&(w.YR.setNodes(e,{markDefs:[]},{at:r}),e.onChange())}}l&&Array.isArray(r.marks)&&r.marks.length>0&&""===r.text&&(w.YR.setNodes(e,{marks:[]},{at:i,voids:!1}),e.onChange())}o&&e.operations.some(e=>["split_node","remove_node","remove_text","merge_node"].includes(e.type))&&function(e){let{selection:t}=e;if(t){let n=w.ML.nodes(e,{at:t,match:e=>e._type===y.block.name});for(let[t,r]of n)if(e.isTextBlock(t)){let n=(t.markDefs||[]).filter(e=>t.children.find(t=>w.xv.isText(t)&&Array.isArray(t.marks)&&t.marks.includes(e._key)));I()(n,t.markDefs)||(tl("Removing markDef not in use"),w.YR.setNodes(e,{markDefs:n},{at:r}),e.onChange())}}}(e)},e.apply=n=>{var i,l;if("insert_text"===n.type){let{selection:o}=e;if(o&&w.e6.isCollapsed(o)&&(null==(l=null==(i=w.ML.marks(e))?void 0:i.marks)?void 0:l.some(e=>!r.includes(e)))){let[i]=Array.from(w.ML.nodes(e,{mode:"lowest",at:o.focus,match:e=>e._type===y.span.name,voids:!1}))[0]||[void 0];if(w.xv.isText(i)&&i.text.length===o.focus.offset&&Array.isArray(i.marks)&&i.marks.length>0){t(n),w.YR.splitNodes(e,{match:w.xv.isText,at:{...o.focus,offset:o.focus.offset}});let i=(({...w.ML.marks(e)||{}}).marks||[]).filter(e=>r.includes(e));w.YR.setNodes(e,{marks:i},{at:w.y$.next(o.focus.path)});return}}}t(n)},e.addMark=t=>{if(e.selection){if(w.e6.isExpanded(e.selection)){w.YR.setNodes(e,{},{match:w.xv.isText,split:!0});let n=[...w.ML.nodes(e,{at:e.selection,match:w.xv.isText})],r=P()(n.map(e=>e[0]).map(e=>e.marks)).includes(t);if(r){e.removeMark(t);return}w.ML.withoutNormalizing(e,()=>{n.forEach(n=>{let[r,i]=n,l=[...(Array.isArray(r.marks)?r.marks:[]).filter(e=>e!==t),t];w.YR.setNodes(e,{marks:l},{at:i,match:w.xv.isText,split:!0,hanging:!0})})}),w.ML.normalize(e)}else{let n={...w.ML.marks(e)||{}}.marks||[],r={...w.ML.marks(e)||{},marks:[...n,t]};e.marks=r}e.onChange()}},e.removeMark=t=>{let{selection:n}=e;if(n){if(w.e6.isExpanded(n))w.ML.withoutNormalizing(e,()=>{if(w.YR.setNodes(e,{},{match:w.xv.isText,split:!0}),e.selection){let n=[...w.ML.nodes(e,{at:e.selection,match:w.xv.isText})];n.forEach(n=>{let[r,i]=n,l=e.children[i[0]];w.W_.isElement(l)&&l.children.includes(r)&&w.YR.setNodes(e,{marks:(Array.isArray(r.marks)?r.marks:[]).filter(e=>e!==t)},{at:i})})}}),w.ML.normalize(e);else{let n={...w.ML.marks(e)||{}}.marks||[],r={...w.ML.marks(e)||{},marks:n.filter(e=>e!==t)};e.marks=r}e.onChange()}},e.pteIsMarkActive=t=>{if(!e.selection||e.selection.focus.path.length<2)return!1;let n={...w.ML.marks(e)||{}}.marks||[];return w.e6.isExpanded(e.selection)&&Array.from(w.ML.nodes(e,{match:w.xv.isText,at:e.selection})).forEach(e=>{let[t]=e;n=q()([...n,...t.marks||[]])}),n.includes(t)},e.pteToggleMark=t=>{let n=e.pteIsMarkActive(t);n?(tl("Remove mark '".concat(t,"'")),w.ML.removeMark(e,t)):(tl("Add mark '".concat(t,"'")),w.ML.addMark(e,t,!0)),e.onChange()},e},j=function(e,t){let n=e.styles[0].value;return function(t){let{normalizeNode:r}=t;return t.normalizeNode=e=>{r(e);let[,i]=e;for(let e of t.operations)if("split_node"===e.type&&1===e.path.length&&t.isTextBlock(e.properties)&&e.properties.style!==n&&e.path[0]===i[0]&&!w.y$.equals(i,e.path)){let[r]=w.ML.node(t,[e.path[0]+1,0]);if(w.xv.isText(r)&&""===r.text){tr("Normalizing split node to ".concat(n," style"),e),w.YR.setNodes(t,{style:n},{at:[e.path[0]+1],voids:!1});break}}},t.pteHasBlockStyle=e=>{if(!t.selection)return!1;let n=[...w.ML.nodes(t,{at:t.selection,match:n=>t.isTextBlock(n)&&n.style===e})];return n.length>0},t.pteToggleBlockStyle=r=>{if(!t.selection)return;let i=[...w.ML.nodes(t,{at:t.selection,match:t=>w.W_.isElement(t)&&t._type===e.block.name})];i.forEach(e=>{let[i,l]=e;t.isTextBlock(i)&&i.style===r?(tr("Unsetting block style '".concat(r,"'")),w.YR.setNodes(t,{...i,style:n},{at:l})):(r?tr("Setting style '".concat(r,"'")):tr("Setting default style",n),w.YR.setNodes(t,{...i,style:r||n},{at:l}))}),t.onChange()},t}}(y),Y=function(e){let{schemaTypes:t,keyGenerator:n}=e;return function(e){return e.createPlaceholderBlock=()=>(tn("Creating placeholder block"),{_type:t.block.name,_key:n(),style:t.styles[0].value||"normal",markDefs:[],children:[{_type:"span",_key:n(),text:"",marks:[]}]}),e}}({keyGenerator:l,schemaTypes:y}),z=function(e){let{schemaTypes:t,keyGenerator:n}=e;return function(e){return e.pteExpandToWord=()=>{let{selection:t}=e;if(t&&!w.e6.isExpanded(t)){let[n]=w.ML.node(e,t.focus,{depth:2});if(!n||!w.xv.isText(n)||0===n.text.length){ts("pteExpandToWord: Can't expand to word here");return}let{focus:r}=t,i=r.offset,l=n.text.slice(0,i),o=n.text.slice(i,-1),a=e=>e.match(/\s/g),s=l.split("").reverse().findIndex(e=>a(e)),c=s>-1?l.length-s:0,h=o.split("").findIndex(e=>a(e)),f=l.length+(h>-1?h:o.length+1);if(!(c===f||isNaN(c)||isNaN(f))){ts("pteExpandToWord: Expanding to focused word"),w.YR.setSelection(e,{anchor:{...t.anchor,offset:c},focus:{...t.focus,offset:f}});return}ts("pteExpandToWord: Can't expand to word here")}},e}}({keyGenerator:l,schemaTypes:y}),V=(r=null,function(e){let t=()=>{if(r!==e.selection){let t=null;if(e.selection){let n=eu.get(e.selection);if(n)t=n;else{let n=e.children;t=eS(n,e.selection,y),eu.set(e.selection,t)}}to("Emitting selection ".concat(JSON.stringify(t||null))),t?k.next({type:"selection",selection:t}):k.next({type:"selection",selection:null})}r=e.selection},{onChange:n}=e;return e.onChange=()=>{let r=e.operations.length>0;n(),r&&t()},e});return(i.destroy=()=>{let e=tg.get(i);if(!e)throw Error("Could not find pristine versions of editor functions");i.onChange=e.onChange,i.apply=e.apply,i.normalizeNode=e.normalizeNode},s)?{editor:b(_(R(j(z(Y(C(V(M(i))))))))),subscribe:()=>E()}:{editor:b(_(R(j(C(Y(z(D(L(N(V(M(i)))))))))))),subscribe:()=>{let t=[];return e.subscriptions.forEach(e=>{t.push(e())}),()=>{t.forEach(e=>{e()})}}}},ty=ei("component:PortableTextEditor:SlateContainer");function tk(e){let{patches$:t,portableTextEditor:n,readOnly:r,maxBlocks:i,keyGenerator:l,isPending:o}=e,[a,s]=(0,h.useMemo)(()=>{ty("Creating new Slate editor instance");let{editor:e,subscribe:a}=tm((0,x.BU)((0,w.Jh)()),{isPending:o,keyGenerator:l,maxBlocks:i,patches$:t,portableTextEditor:n,readOnly:r});return ep.set(e,{}),ed.set(e,{}),[e,a]},[]);(0,h.useEffect)(()=>{let e=s();return()=>{e()}},[s]),(0,h.useEffect)(()=>{ty("Re-initializing plugin chain"),tm(a,{isPending:o,keyGenerator:l,maxBlocks:i,patches$:t,portableTextEditor:n,readOnly:r})},[l,n,i,r,t,a,o]);let f=(0,h.useMemo)(()=>[a.createPlaceholderBlock()],[a]);return(0,h.useEffect)(()=>()=>{ty("Destroying Slate editor"),a.destroy()},[a]),(0,c.jsx)(x.mH,{editor:a,value:f,children:e.children})}let tv=(0,h.createContext)(null),t_=()=>{let e=(0,h.useContext)(tv);if(void 0===e)throw Error("The `usePortableTextEditorSelection` hook must be used inside the <PortableTextEditor> component's context.");return e},tb=(0,h.createContext)(null),tx=()=>{let e=(0,h.useContext)(tb);if(!e)throw Error("The `usePortableTextEditor` hook must be used inside the <PortableTextEditor> component's context.");return e},tw=(0,h.createContext)(void 0),tM=(0,h.createContext)(!1),tE=()=>{let e=(0,h.useContext)(tM);if(void 0===e)throw Error("The `usePortableTextEditorReadOnly` hook must be used inside the <PortableTextEditor> component's context.");return e},tN=ei("hook:useSyncValue"),tT=ei("component:PortableTextEditor:Synchronizer");function tD(e){let{change$:t,portableTextEditor:n,isPending:r,onChange:i,keyGenerator:l,readOnly:o,value:a}=e,[s,f]=(0,h.useState)(null),d=(0,h.useRef)([]),p=function(e){let{portableTextEditor:t,isPending:n,readOnly:r,keyGenerator:i}=e,{change$:l,schemaTypes:o}=t,a=(0,h.useRef)(),s=(0,x.ui)();return(0,h.useMemo)(()=>e=>{if(n.current&&!r){tN("Has local patches");return}if(a.current===e){tN("Value is the same object"),l.next({type:"value",value:e});return}if(e&&0===e.length){let t=tf(e,o,i);l.next({type:"invalidValue",resolution:t.resolution,value:e});return}let t=!1,c=!0;if(a.current=e,e&&0!==e.length||(tN("Value is empty"),te(s,()=>{ej(s,()=>{w.ML.withoutNormalizing(s,()=>{let e=!!s.selection;e&&w.YR.deselect(s);let t=s.children.length;s.children.forEach((e,n)=>{w.YR.removeNodes(s,{at:[t-1-n]})}),w.YR.insertNodes(s,s.createPlaceholderBlock(),{at:[0]}),e&&w.YR.select(s,[0,0])})})}),t=!0),e&&e.length>0){let n=eE(e,{schemaTypes:o},ed.get(s));te(s,()=>{ej(s,()=>{w.ML.withoutNormalizing(s,()=>{let r=s.children.length;if(n.length<r){for(let e=r-1;e>n.length-1;e--)w.YR.removeNodes(s,{at:[e]});t=!0}n.forEach((n,r)=>{let a=s.children[r],h=a&&!I()(n,a);if(h&&c){let h=[e[r]],f=tf(h,o,i);f.valid?(a._key===n._key?(tN("Updating block",a,n),function(e,t,n,r){if(w.YR.setNodes(e,t,{at:[r]}),e.isTextBlock(t)&&e.isTextBlock(n)){let i=n.children.length;t.children.length<i&&Array.from(Array(i-t.children.length)).forEach((t,n)=>{let l=i-1-n;l>0&&(tN("Removing child"),w.YR.removeNodes(e,{at:[r,l]}))}),t.children.forEach((i,l)=>{let o=n.children[l],a=!I()(i,o);a&&(i._key===(null==o?void 0:o._key)?(tN("Updating changed child",i),w.YR.setNodes(e,i,{at:[r,l]}),"span"!==i._type&&(tN("Updating changed inline object child",i),w.YR.setNodes(e,{_key:"".concat(t._key,"-void-child")},{at:[r,l,0],voids:!0}))):o?(tN("Replacing child",i),w.YR.removeNodes(e,{at:[r,l]}),eI(e,()=>{w.YR.insertNodes(e,i,{at:[r,l]})})):o||(tN("Inserting new child",i),eI(e,()=>{w.YR.insertNodes(e,i,{at:[r,l]})})))})}}(s,n,a,r)):(tN("Replacing block",a,n),function(e,t,n){let r=e.selection,i=r&&r.focus.path[0]===n;i&&w.YR.deselect(e),w.YR.removeNodes(e,{at:[n]}),eI(e,()=>{w.YR.insertNodes(e,t,{at:[n]})}),i&&w.YR.select(e,r)}(s,n,r)),t=!0):(l.next({type:"invalidValue",resolution:f.resolution,value:e}),c=!1)}if(!a&&c){let t=[e[r]],a=tf(t,o,i);tN("Validating and inserting new block in the end of the value",n),a.valid?eI(s,()=>{w.YR.insertNodes(s,n,{at:[r]})}):(l.next({type:"invalidValue",resolution:a.resolution,value:e}),c=!1)}})})})})}if(!c){tN("Invalid value, returning");return}t?(tN("Server value changed, syncing editor"),w.ML.normalize(s),s.onChange(),l.next({type:"value",value:e})):tN("Server value and editor value is the same, no need to sync.")},[l,n,i,r,o,s])}({isPending:r,keyGenerator:l,onChange:i,portableTextEditor:n,readOnly:o}),u=(0,h.useCallback)(()=>{let e=[...d.current];tT("Flushing pending patches",e),e.length>0&&(d.current=d.current.splice(e.length,d.current.length),i({type:"mutation",patches:e}))},[i]),g=(0,h.useMemo)(()=>X()(u,1e3,{leading:!1,trailing:!0}),[u]);(0,h.useEffect)(()=>()=>{u()},[u]),(0,h.useEffect)(()=>{tT("Subscribing to editor changes$");let e=t.subscribe(e=>{switch(e.type){case"patch":r.current=!0,d.current.push(e.patch),i(e),g();break;case"selection":(0,h.startTransition)(()=>{tT("Setting selection"),f(e.selection)}),i(e);break;default:i(e)}});return()=>{tT("Unsubscribing to changes$"),e.unsubscribe()}},[t,g,i,p,r]);let m=(0,h.useRef)(!0);return(0,h.useEffect)(()=>{tT("Value from props changed, syncing new value"),p(a),m.current&&(t.next({type:"loading",isLoading:!1}),t.next({type:"ready"}),m.current=!1)},[t,p,a]),(0,c.jsx)(eo.Provider,{value:l,children:(0,c.jsx)(tb.Provider,{value:n,children:(0,c.jsx)(tw.Provider,{value:a,children:(0,c.jsx)(tM.Provider,{value:o,children:(0,c.jsx)(tv.Provider,{value:s,children:e.children})})})})})}let tA=ei("component:PortableTextEditor");class tC extends h.Component{constructor(e){if(super(e),this.change$=new y.x,this.setEditable=e=>{this.editable={...this.editable,...e}},!e.schemaType)throw Error('PortableTextEditor: missing "type" property');e.incomingPatches$&&console.warn("The prop 'incomingPatches$' is deprecated and renamed to 'patches$'"),this.change$.next({type:"loading",isLoading:!0}),this.isPending=(0,h.createRef)(),this.isPending.current=!1,this.schemaTypes=en(e.schemaType.hasOwnProperty("jsonType")?e.schemaType:et(e.schemaType))}componentDidUpdate(e){this.props.schemaType!==e.schemaType&&(this.schemaTypes=en(this.props.schemaType.hasOwnProperty("jsonType")?this.props.schemaType:et(this.props.schemaType)))}render(){let{onChange:e,value:t,children:n,patches$:r,incomingPatches$:i}=this.props,{change$:l,isPending:o}=this,a=void 0===this.props.maxBlocks?void 0:parseInt(this.props.maxBlocks.toString(),10)||void 0,s=!!this.props.readOnly,h=this.props.keyGenerator||el;return(0,c.jsx)(tk,{isPending:o,keyGenerator:h,maxBlocks:a,patches$:i||r,portableTextEditor:this,readOnly:s,children:(0,c.jsx)(tD,{change$:l,isPending:o,keyGenerator:h,onChange:e,portableTextEditor:this,readOnly:s,value:t,children:n})})}}function tS(e,t){if(!e||!t)return null;let n=[],r=e.offset||0,i="object"==typeof e.path[0]&&"_key"in e.path[0]&&e.path[0]._key,l="object"==typeof e.path[2]&&"_key"in e.path[2]&&e.path[2]._key,o=t.find(e=>e._key===i);if(!o)return null;if(n.push({_key:o._key}),o&&"children"===e.path[1]){if(!o.children||Array.isArray(o.children)&&0===o.children.length)return null;let t=Array.isArray(o.children)&&o.children.find(e=>e._key===l);if(!t)return null;n.push("children"),n.push({_key:t._key}),r=t.text&&t.text.length>=e.offset?e.offset:t.text&&t.text.length||0}return{path:n,offset:r}}function tL(e){let t=(0,h.useCallback)(()=>alert(JSON.stringify(e.annotation)),[e.annotation]);return(0,c.jsx)("span",{style:{color:"blue"},onClick:t,children:e.children})}tC.activeAnnotations=e=>e&&e.editable?e.editable.activeAnnotations():[],tC.addAnnotation=(e,t,n)=>{var r;return null==(r=e.editable)?void 0:r.addAnnotation(t,n)},tC.blur=e=>{var t;tA("Host blurred"),null==(t=e.editable)||t.blur()},tC.delete=(e,t,n)=>{var r;return null==(r=e.editable)?void 0:r.delete(t,n)},tC.findDOMNode=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.findDOMNode(t)},tC.findByPath=(e,t)=>{var n;return(null==(n=e.editable)?void 0:n.findByPath(t))||[]},tC.focus=e=>{var t;tA("Host requesting focus"),null==(t=e.editable)||t.focus()},tC.focusBlock=e=>{var t;return null==(t=e.editable)?void 0:t.focusBlock()},tC.focusChild=e=>{var t;return null==(t=e.editable)?void 0:t.focusChild()},tC.getSelection=e=>e.editable?e.editable.getSelection():null,tC.getValue=e=>{var t;return null==(t=e.editable)?void 0:t.getValue()},tC.hasBlockStyle=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.hasBlockStyle(t)},tC.hasListStyle=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.hasListStyle(t)},tC.isCollapsedSelection=e=>{var t;return null==(t=e.editable)?void 0:t.isCollapsedSelection()},tC.isExpandedSelection=e=>{var t;return null==(t=e.editable)?void 0:t.isExpandedSelection()},tC.isMarkActive=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.isMarkActive(t)},tC.insertChild=(e,t,n)=>{var r;return tA("Host inserting child"),null==(r=e.editable)?void 0:r.insertChild(t,n)},tC.insertBlock=(e,t,n)=>{var r;return null==(r=e.editable)?void 0:r.insertBlock(t,n)},tC.insertBreak=e=>{var t;return null==(t=e.editable)?void 0:t.insertBreak()},tC.isVoid=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.isVoid(t)},tC.isObjectPath=(e,t)=>{if(!t||!Array.isArray(t))return!1;let n=t.length>3&&"children"===t[1],r=t.length>1&&"children"!==t[1];return r||n},tC.marks=e=>{var t;return null==(t=e.editable)?void 0:t.marks()},tC.select=(e,t)=>{var n;tA("Host setting selection",t),null==(n=e.editable)||n.select(t)},tC.removeAnnotation=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.removeAnnotation(t)},tC.toggleBlockStyle=(e,t)=>{var n;return tA("Host is toggling block style"),null==(n=e.editable)?void 0:n.toggleBlockStyle(t)},tC.toggleList=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.toggleList(t)},tC.toggleMark=(e,t)=>{var n;tA("Host toggling mark",t),null==(n=e.editable)||n.toggleMark(t)};let tP=ei("components:Leaf"),tR=[],tI=e=>{let{attributes:t,children:n,leaf:r,schemaTypes:i,renderChild:l,renderDecorator:o,renderAnnotation:a}=e,s=h.useRef(null),f=tx(),d=(0,x.vt)(),[p,u]=(0,h.useState)(!1),[g,m]=(0,h.useState)(!1),y=n.props.parent,k=(0,h.useMemo)(()=>y?[{_key:null==y?void 0:y._key},"children",{_key:r._key}]:[],[y,r._key]),v=(0,h.useMemo)(()=>i.decorators.map(e=>e.value),[i.decorators]),_=(0,h.useMemo)(()=>q()((r.marks||tR).filter(e=>v.includes(e))),[v,r.marks]),b=Array.isArray(r.marks)?r.marks:tR,M=(0,h.useMemo)(()=>b.map(e=>{var t;return!v.includes(e)&&(null==(t=null==y?void 0:y.markDefs)?void 0:t.find(t=>t._key===e))}).filter(Boolean),[b,y,v]),E=M.length>0&&d;(0,h.useEffect)(()=>{if(!E){u(!1);return}let e=tC.getSelection(f);e&&I()(e.focus.path,k)&&tC.isCollapsedSelection(f)&&(0,h.startTransition)(()=>{u(!0)})},[E,k,f]);let N=(0,h.useCallback)(()=>{if(!E)return;tP("Setting selection and focus from range");let e=window.getSelection();if(!e){m(!1);return}if(e&&e.rangeCount>0){let t=e.getRangeAt(0);s.current&&t.intersectsNode(s.current)?m(!0):m(!1)}else m(!1)},[E]);(0,h.useEffect)(()=>{if(!E)return;let e=f.change$.subscribe(e=>{if("blur"===e.type){u(!1),m(!1);return}if("focus"===e.type){let e=tC.getSelection(f);e&&I()(e.focus.path,k)&&tC.isCollapsedSelection(f)&&u(!0),N();return}"selection"===e.type&&(e.selection&&I()(e.selection.focus.path,k)&&tC.isCollapsedSelection(f)?u(!0):u(!1),N())});return()=>{e.unsubscribe()}},[k,f,N,E]),(0,h.useEffect)(()=>N(),[N]);let T=(0,h.useMemo)(()=>{let e=n;if(w.xv.isText(r)&&r._type===i.span.name&&(_.forEach(t=>{let n=i.decorators.find(e=>e.value===t);if(n&&o){let r=Object.defineProperty({children:e,editorElementRef:s,focused:p,path:k,selected:g,schemaType:n,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),n)});e=o(r)}}),y&&M.length>0&&M.forEach(t=>{let n=i.annotations.find(e=>e.name===t._type);if(n){if(a){let r=Object.defineProperty({block:y,children:e,editorElementRef:s,focused:p,path:k,selected:g,schemaType:n,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),n)});e=(0,c.jsx)("span",{ref:s,children:a(r)})}else e=(0,c.jsx)(tL,{annotation:t,children:(0,c.jsx)("span",{ref:s,children:e})})}}),y&&l)){let t=y.children.find(e=>e._key===r._key);if(t){let n=(0,c.jsx)(c.Fragment,{children:e}),r=Object.defineProperty({annotations:M,children:n,editorElementRef:s,focused:p,path:k,schemaType:i.span,selected:g,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),i.span)});e=l(r)}}return e},[M,y,n,p,r,_,k,a,l,o,i.annotations,i.decorators,i.span,g]);return(0,h.useMemo)(()=>(0,c.jsx)("span",{...t,ref:s,children:T},r._key),[r,t,T])},tB=e=>(0,c.jsx)("div",{children:(0,c.jsx)("pre",{children:JSON.stringify(e.value,null,2)})}),tj=Q.ZP.div(l||(l=ee(["\n  user-select: none;\n  border: ",";\n"])),e=>e.selected?"1px solid blue":"1px solid transparent");Q.ZP.span(o||(o=ee(["\n  background: #999;\n  border: ",";\n"])),e=>e.selected?"1px solid blue":"1px solid transparent");let tO=Q.ZP.div(a||(a=ee(["\n  &.pt-list-item {\n    width: fit-content;\n    position: relative;\n    display: block;\n\n    /* Important 'transform' in order to force refresh the ::before and ::after rules\n      in Webkit: https://stackoverflow.com/a/21947628/831480\n    */\n    transform: translateZ(0);\n    margin-left: ",";\n  }\n  &.pt-list-item > .pt-list-item-inner {\n    display: flex;\n    margin: 0;\n    padding: 0;\n    &:before {\n      justify-content: flex-start;\n      vertical-align: top;\n    }\n  }\n  &.pt-list-item-bullet > .pt-list-item-inner:before {\n      content: '","';\n      font-size: 0.4375rem; /* 7px */\n      line-height: 1.5rem; /* Same as body text */\n      /* Optical alignment */\n      position: relative;\n    }\n  }\n  &.pt-list-item-bullet > .pt-list-item-inner {\n    &:before {\n      min-width: 1.5rem; /* Make sure space between bullet and text never shrinks */\n    }\n  }\n  &.pt-list-item-number {\n    counter-increment: ",";\n    counter-reset: ",";\n  }\n  & + :not(.pt-list-item-number) {\n    counter-reset: listItemNumber;\n  }\n  &.pt-list-item-number > .pt-list-item-inner:before {\n    content: ",";\n    min-width: 1.5rem; /* Make sure space between number and text never shrinks */\n    /* Optical alignment */\n    position: relative;\n    top: 1px;\n  }\n"])),e=>(function(e){switch(Number(e)){case 1:return"1.5em";case 2:return"3em";case 3:return"4.5em";case 4:return"6em";case 5:return"7.5em";case 6:return"9em";case 7:return"10.5em";case 8:return"12em";case 9:return"13.5em";case 10:return"15em";default:return"0em"}})(e.listLevel),e=>{var t;return t=e.listLevel,"bullet"===e.listStyle?tW[(t-1)%3]:"*"},e=>(function(e){switch(e){case 1:return"listItemNumber";case 2:return"listItemAlpha";case 3:return"listItemRoman";case 4:return"listItemNumberNext";case 5:return"listItemLetterNext";case 6:return"listItemRomanNext";case 7:return"listItemNumberNextNext";case 8:return"listItemAlphaNextNext";case 9:return"listItemRomanNextNext";default:return"listItemNumberNextNextNext"}})(e.listLevel),e=>(function(e){switch(e){case 1:return"listItemAlpha";case 2:return"listItemRoman";case 3:return"listItemNumberNext";case 4:return"listItemLetterNext";case 5:return"listItemRomanNext";case 6:return"listItemNumberNextNext";case 7:return"listItemAlphaNextNext";case 8:return"listItemRomanNextNext";default:return"listItemNumberNextNextNext"}})(e.listLevel),e=>(function(e){switch(e){case 1:return"counter(listItemNumber) '. '";case 2:return"counter(listItemAlpha, lower-alpha) '. '";case 3:return"counter(listItemRoman, lower-roman) '. '";case 4:return"counter(listItemNumberNext) '. '";case 5:return"counter(listItemLetterNext, lower-alpha) '. '";case 6:return"counter(listItemRomanNext, lower-roman) '. '";case 7:return"counter(listItemNumberNextNext) '. '";case 8:return"counter(listItemAlphaNextNext, lower-alpha) '. '";case 9:return"counter(listItemRomanNextNext, lower-roman) '. '";default:return"counter(listItemNumberNextNextNext) '. '"}})(e.listLevel)),tY=Q.ZP.div(s||(s=ee([""]))),tW=["●","○","■"],tz=ei("components:DraggableBlock"),tJ=e=>{let{children:t,element:n,readOnly:r,blockRef:i}=e,l=(0,x._7)(),o=(0,h.useRef)(),[a,s]=(0,h.useState)(!1),f=(0,h.useMemo)(()=>w.ML.isVoid(l,n),[l,n]),d=(0,h.useMemo)(()=>w.ML.isInline(l,n),[l,n]),[p,u]=(0,h.useState)(null);(0,h.useEffect)(()=>u(i?i.current:x.F3.toDOMNode(l,n)),[l,n,i]);let g=(0,h.useCallback)(e=>{let t=ec.get(l);if(!t||!p)return;e.preventDefault(),e.dataTransfer.dropEffect="move",eh.set(l,n);let r=p.getBoundingClientRect(),i=r.top,o=r.height,a=e.pageY,c="bottom";if(n===l.children[0]?c="top":Math.abs(i-a)<o/2?(c="top",ef.set(l,c)):(c="bottom",ef.set(l,c)),t===n){e.dataTransfer.dropEffect="none";return}s(!0)},[p,l,n]),m=(0,h.useCallback)(()=>{s(!1)},[]),y=(0,h.useCallback)(e=>{let t=eh.get(l);if(t){es.set(l,!1),e.preventDefault(),e.stopPropagation(),eh.delete(l),o.current&&(tz("Removing drag ghost"),document.body.removeChild(o.current));let r=ef.get(l);ef.delete(l);let i=x.F3.findPath(l,t),a=x.F3.findPath(l,n),s=w.y$.isBefore(a,i);if("bottom"===r&&!s){if(i[0]>=l.children.length-1){tz("target is already at the bottom, not moving");return}let e=i;i=w.y$.next(i),tz("Adjusting targetPath from ".concat(JSON.stringify(e)," to ").concat(JSON.stringify(i)))}if("top"===r&&s&&i[0]!==l.children.length-1){let e=i;i=w.y$.previous(i),tz("Adjusting targetPath from ".concat(JSON.stringify(e)," to ").concat(JSON.stringify(i)))}if(w.y$.equals(i,a)){e.preventDefault(),tz("targetPath and myPath is the same, not moving");return}tz("Moving element ".concat(n._key," from path ").concat(JSON.stringify(a)," to ").concat(JSON.stringify(i)," (").concat(r,")")),w.YR.moveNodes(l,{at:a,to:i}),l.onChange();return}tz("No target element, not doing anything")},[l,n]),k=(0,h.useCallback)(e=>{ec.get(l)&&(tz("On drop (prevented)",n),e.preventDefault(),e.stopPropagation(),s(!1))},[l,n]),v=(0,h.useCallback)(e=>{if(!f){ec.delete(l);return}es.set(l,!0),ec.set(l,n),e.stopPropagation();let t=e.target;t instanceof HTMLElement&&(t.style.opacity="1")},[l,n,f]),_=(0,h.useCallback)(e=>{if(!f||d){tz("Not dragging block"),ec.delete(l),es.set(l,!1);return}if(tz("Drag start"),es.set(l,!0),e.dataTransfer&&(e.dataTransfer.setData("application/portable-text","something"),e.dataTransfer.effectAllowed="move"),p&&p instanceof HTMLElement){let t=p.cloneNode(!0),n=t.querySelector("[data-pt-drag-ghost-element]");if(n&&(t=n),t.setAttribute("data-dragged",""),document.body){o.current=t,t.style.position="absolute",t.style.left="-99999px",t.style.boxSizing="border-box",document.body.appendChild(t);let n=p.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top;t.style.width="".concat(n.width,"px"),t.style.height="".concat(n.height,"px"),e.dataTransfer.setDragImage(t,r,i)}}v(e)},[p,l,v,d,f]),b=a&&l.children[0]===eh.get(l),M=a&&l.children[l.children.length-1]===eh.get(l),E=ef.get(l),N=(0,h.useMemo)(()=>(0,c.jsx)("div",{className:"pt-drop-indicator",style:{position:"absolute",width:"100%",height:1,borderBottom:"1px solid currentColor",zIndex:5}}),[]);return r?(0,c.jsx)(c.Fragment,{children:t}):(0,c.jsxs)("div",{draggable:f,onDragStart:_,onDrag:v,onDragOver:g,onDragLeave:m,onDragEnd:y,onDrop:k,children:[(b||a&&!b&&!M&&"top"===E)&&N,t,(M||a&&!b&&!M&&"bottom"===E)&&N]})};ei("components:Element");let tV=[],tF={display:"inline-block"},tU=e=>{let t,n,{attributes:r,children:i,element:l,schemaTypes:o,readOnly:a,renderBlock:s,renderChild:f,renderListItem:d,renderStyle:p,spellCheck:u}=e,g=(0,x._7)(),m=(0,x.vt)(),y=(0,h.useRef)(null),k=(0,h.useRef)(null),v=m&&g.selection&&w.e6.isCollapsed(g.selection)||!1,_=(0,h.useMemo)(()=>eN([l],o.block.name,ep.get(g))[0],[g,l,o.block.name]),b=i,M=(0,h.useMemo)(()=>[{_key:l._key}],[l]);if("string"!=typeof l._type)throw Error("Expected element to have a _type property");if("string"!=typeof l._key)throw Error("Expected element to have a _key property");if(g.isInline(l)){let e=x.F3.findPath(g,l),[t]=w.ML.node(g,e,{depth:1}),n=o.inlineObjects.find(e=>e.name===l._type);if(!n)throw Error("Could not find type for inline block element");if(w.W_.isElement(t)){let e=[{_key:t._key},"children",{_key:l._key}];return(0,c.jsxs)("span",{...r,children:[i,(0,c.jsxs)("span",{draggable:!a,className:"pt-inline-object",ref:k,style:tF,contentEditable:!1,children:[f&&f({annotations:tV,children:(0,c.jsx)(tB,{value:_}),editorElementRef:k,focused:v,path:e,schemaType:n,selected:m,type:n,value:_}),!f&&(0,c.jsx)(tB,{value:_})]},l._key)]})}throw Error("Block not found!")}if(l._type===o.block.name){let e;t="pt-block pt-text-block";let n="listItem"in l,h="style"in l&&l.style||"normal";t="pt-block pt-text-block pt-text-block-style-".concat(h);let f=o.styles.find(e=>e.value===h);if(p&&f&&(b=p({block:l,children:i,focused:v,selected:m,value:h,path:M,schemaType:f,editorElementRef:y})),n&&("number"==typeof l.level&&(e=l.level),t+=" pt-list-item pt-list-item-".concat(l.listItem," pt-list-item-level-").concat(e||1)),g.isListBlock(_)&&n&&l.listItem){let e=o.lists.find(e=>e.value===l.listItem);b=d&&e?d({block:_,children:b,focused:v,selected:m,value:l.listItem,path:M,schemaType:e,level:_.level||1,editorElementRef:y}):(0,c.jsx)(tO,{listStyle:_.listItem||o.lists[0].value,listLevel:_.level||1,children:(0,c.jsx)(tY,{children:b})})}let k=Object.defineProperty({children:b,editorElementRef:y,focused:v,level:e,listItem:n?l.listItem:void 0,path:M,selected:m,style:h,schemaType:o.block,value:_},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),o.block)}),x=s?s(k):i;return(0,c.jsx)("div",{...r,className:t,spellCheck:u,children:(0,c.jsx)(tJ,{element:l,readOnly:a,blockRef:y,children:(0,c.jsx)("div",{ref:y,children:x})})},l._key)}let E=o.blockObjects.find(e=>e.name===l._type);if(!E)throw Error("Could not find schema type for block element of _type ".concat(l._type));t="pt-block pt-object-block";let N=eN([l],o.block.name,ep.get(g))[0];if(s){let e=Object.defineProperty({children:(0,c.jsx)(tB,{value:_}),editorElementRef:y,focused:v,path:M,schemaType:E,selected:m,value:N},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),E)});n=s(e)}return(0,c.jsxs)("div",{...r,className:t,children:[i,(0,c.jsxs)(tJ,{element:l,readOnly:a,blockRef:y,children:[n&&(0,c.jsx)("div",{ref:y,contentEditable:!1,children:n}),!n&&(0,c.jsx)(tj,{selected:m,children:(0,c.jsx)(tB,{value:_})})]})]},l._key)},t$="undefined"==typeof window?h.useEffect:h.useLayoutEffect,tH=ei("component:Editable"),tq={opacity:.5,position:"absolute",userSelect:"none",pointerEvents:"none"},tZ=[],tG=(0,h.forwardRef)(function(e,t){let{hotkeys:n,onBeforeInput:r,onPaste:i,onCopy:l,renderAnnotation:o,renderBlock:a,renderChild:s,renderDecorator:f,renderListItem:d,renderPlaceholder:p,renderStyle:u,selection:g,scrollSelectionIntoView:m,spellCheck:y,...k}=e,v=tx(),_=tE(),b=ea(),M=function(e){let t=(0,h.useRef)(null);return t$(()=>{e&&("function"==typeof e?e(t.current):e.current=t.current)}),t}(t),[N,T]=(0,h.useState)(!1),{change$:D,schemaTypes:A}=v,C=(0,x.ui)(),S=A.block.name,L=(0,h.useMemo)(()=>function(e){let t=A.block.name,n=A.span.name,r=t=>t.map(t=>{var r;return e.isTextBlock(t)?t.children.map(e=>{var t;return e._type===n?e.text:"[".concat((null==(t=A.inlineObjects.find(t=>t.name===e._type))?void 0:t.title)||"Object","]")}).join(""):"[".concat((null==(r=A.blockObjects.find(e=>e.name===t._type))?void 0:r.title)||"Object","]")}).join("\n\n");return e.setFragmentData=(n,i)=>{let{selection:l}=e;if(!l)return;let[o,a]=w.e6.edges(l),s=w.ML.void(e,{at:o.path}),c=w.ML.void(e,{at:a.path});if(w.e6.isCollapsed(l)&&!s)return;let h=x.F3.toDOMRange(e,l),f=h.cloneContents();if(c){let[t]=c,n=h.cloneRange(),r=x.F3.toDOMNode(e,t);n.setEndAfter(r),f=n.cloneContents()}Array.from(f.querySelectorAll("[data-slate-zero-width]")).forEach(e=>{let t="n"===e.getAttribute("data-slate-zero-width");e.textContent=t?"\n":""}),Array.from(f.querySelectorAll("*")).forEach(e=>{for(let t in e.removeAttribute("contentEditable"),e.removeAttribute("data-slate-inline"),e.removeAttribute("data-slate-leaf"),e.removeAttribute("data-slate-node"),e.removeAttribute("data-slate-spacer"),e.removeAttribute("data-slate-string"),e.removeAttribute("data-slate-zero-width"),e.removeAttribute("draggable"),e.attributes)e.hasAttribute(t)&&e.removeAttribute(t)});let d=f.ownerDocument.createElement("div");d.appendChild(f),d.setAttribute("hidden","true"),f.ownerDocument.body.appendChild(d);let p=d.innerHTML;f.ownerDocument.body.removeChild(d);let u=e.getFragment(),g=eN(u,t),m=JSON.stringify(g),y=r(g);n.clearData(),n.setData("text/plain",y),n.setData("text/html",p),n.setData("application/json",m),n.setData("application/x-portable-text",m),td("text",y),n.setData("application/x-portable-text-event-origin",i||"external"),td("Set fragment data",m,p)},e.insertPortableTextData=t=>{var r;if(!e.selection)return!1;let i=t.getData("application/x-portable-text"),l=t.getData("application/x-portable-text-event-origin");if(td("Inserting portable text from ".concat(l," event"),i),i){let t=JSON.parse(i);if(Array.isArray(t)&&t.length>0){let i=eE(t,{schemaTypes:A}).map(t=>{let r={...t};e.isTextBlock(r)&&(r.markDefs=(r.markDefs||[]).map(t=>{let i=t._key,l=b();return r.children=r.children.map(t=>t._type===n&&e.isTextSpan(t)?{...t,marks:t.marks&&t.marks.includes(i)?[...t.marks].filter(e=>e!==i).concat(l):t.marks}:t),{...t,_key:l}}));let i={...r,_key:b()};return e.isTextBlock(i)&&(i.children=i.children.map(e=>({...e,_key:b()}))),i}),l=tf(t,A,b);if(!l.valid){let e="".concat(null==(r=l.resolution)?void 0:r.description);return D.next({type:"error",level:"warning",name:"pasteError",description:e,data:l}),td("Invalid insert result",l),!1}return tu(e,i,A),!0}}return!1},e.insertTextOrHTMLData=n=>{var r;if(!e.selection)return td("No selection, not inserting"),!1;D.next({type:"loading",isLoading:!0});let i=n.getData("text/html"),l=n.getData("text/plain");if(i||l){let o,a,s;if(td("Inserting data",n),i)a=eE(o=(0,G.zW)(i,A.portableText).map(e=>(0,G.nX)(e,{blockTypeName:t})),{schemaTypes:A}),s="HTML";else{let e=String(l).replace(/[&<>"'`=/]/g,e=>tp[e]).split(/\n{2,}/).map(e=>e?"<p>".concat(e.replace(/(?:\r\n|\r|\n)/g,"<br/>"),"</p>"):"<p></p>").join("");a=eE(o=(0,G.zW)("<html><body>".concat(e,"</body></html>"),A.portableText).map(e=>(0,G.nX)(e,{blockTypeName:t})),{schemaTypes:A}),s="text"}let c=tf(o,A,b);if(!c.valid){let e="Could not validate the resulting portable text to insert.\n".concat(null==(r=c.resolution)?void 0:r.description,"\nTry to insert as plain text (shift-paste) instead.");return D.next({type:"error",level:"warning",name:"pasteError",description:e,data:c}),td("Invalid insert result",c),!1}return td("Inserting ".concat(s," fragment at ").concat(JSON.stringify(e.selection))),tu(e,a,A),D.next({type:"loading",isLoading:!1}),!0}return D.next({type:"loading",isLoading:!1}),!1},e.insertData=t=>{e.insertPortableTextData(t)||e.insertTextOrHTMLData(t)},e.insertFragmentData=t=>{let n=t.getData("application/x-portable-text");if(n){let t=JSON.parse(n);return e.insertFragment(t),!0}return!1},e},[D,b,A]),P=(0,h.useMemo)(()=>(function(e,t,n,r){let i=["enter","tab","shift","delete","end"],l=r||th,o=()=>eE([{_type:e.block.name,_key:t(),style:"normal",markDefs:[],children:[{_type:"span",_key:t(),text:"",marks:[]}]}],n)[0];return function(t){return t.pteWithHotKeys=r=>{Object.keys(l).forEach(e=>{if("marks"===e)for(let n in l[e]){if(i.includes(n))throw Error("The hotkey ".concat(n," is reserved!"));if((0,Z.ZP)(n,r.nativeEvent)){r.preventDefault();let i=l[e];if(i){let e=i[n];tc("HotKey ".concat(n," to toggle ").concat(e)),t.pteToggleMark(e)}}}if("custom"===e)for(let t in l[e]){if(i.includes(t))throw Error("The hotkey ".concat(t," is reserved!"));if((0,Z.ZP)(t,r.nativeEvent)){let i=l[e];if(i){let e=i[t];e(r,n)}}}});let a=(0,Z.ZP)("enter",r.nativeEvent),s=(0,Z.ZP)("tab",r.nativeEvent),c=(0,Z.ZP)("shift+enter",r.nativeEvent),h=(0,Z.ZP)("shift+tab",r.nativeEvent),f=(0,Z.ZP)("backspace",r.nativeEvent),d=(0,Z.ZP)("delete",r.nativeEvent);if(f&&t.selection&&t.selection.focus.path[0]>0&&w.e6.isCollapsed(t.selection)){let[e,n]=w.ML.node(t,w.y$.previous(t.selection.focus.path.slice(0,1))),[i]=w.ML.node(t,t.selection.focus,{depth:1});if(e&&i&&w.ML.isVoid(t,e)&&0===t.selection.focus.offset){tc("Preventing deleting void block above"),r.preventDefault(),r.stopPropagation(),w.YR.removeNodes(t,{match:e=>e===i}),w.YR.select(t,n),t.onChange();return}}if(d&&t.selection&&0===t.selection.focus.offset&&w.e6.isCollapsed(t.selection)&&t.children[t.selection.focus.path[0]+1]){let[e]=w.ML.node(t,w.y$.next(t.selection.focus.path.slice(0,1))),[n,i]=w.ML.node(t,t.selection.focus,{depth:1});if(e&&n&&!w.ML.isVoid(t,n)&&w.ML.isVoid(t,e)){tc("Preventing deleting void block below"),r.preventDefault(),r.stopPropagation(),w.YR.removeNodes(t,{match:e=>e===n}),w.YR.select(t,i),t.onChange();return}}if((s||h)&&t.selection){let[e]=w.ML.node(t,t.selection.focus,{depth:2}),[n]=(0,B.NG)(e)?w.ML.node(t,t.selection.focus,{depth:1}):[],i=e&&(0,B.DG)(n)&&(0,B.NG)(e)&&(e.marks||[]).filter(e=>(n.markDefs||[]).map(e=>e._key).includes(e)).length>0,[l]=w.e6.edges(t.selection),o=w.ML.isStart(t,l,l.path);e&&(0,B.NG)(e)&&(!i||o)&&t.pteIncrementBlockLevels(h)&&r.preventDefault()}if(a&&!c&&t.selection){let n;try{[n]=w.ML.node(t,t.selection.focus,{depth:1})}catch(e){}if(t.isListBlock(n)){t.pteEndList()&&r.preventDefault();return}if(t.isTextBlock(n)&&n.style&&n.style!==e.styles[0].value){let[,e]=w.e6.edges(t.selection),n=w.ML.isEnd(t,e,e.path);if(n){w.ML.insertNode(t,o()),r.preventDefault();return}}if(n&&w.ML.isVoid(t,n)){w.ML.insertNode(t,o()),r.preventDefault();return}}if(c){r.preventDefault(),t.insertText("\n");return}if((0,Z.ZP)("mod+z",r.nativeEvent)){r.preventDefault(),t.undo();return}((0,Z.ZP)("mod+y",r.nativeEvent)||(0,Z.ZP)("mod+shift+z",r.nativeEvent))&&(r.preventDefault(),t.redo())},t}})(A,b,v,n),[n,b,v,A]);(0,h.useMemo)(()=>_?(tH("Editable is in read only mode"),L(C)):(tH("Editable is in edit mode"),L(P(C))),[_,C,P,L]);let R=(0,h.useCallback)(e=>(0,c.jsx)(tU,{...e,readOnly:_,renderBlock:a,renderChild:s,renderListItem:d,renderStyle:u,schemaTypes:A,spellCheck:y}),[A,y,_,a,s,d,u]),j=(0,h.useCallback)(e=>{let t=(0,c.jsx)(tI,{...e,schemaTypes:A,renderAnnotation:o,renderChild:s,renderDecorator:f,readOnly:_});return p&&e.leaf.placeholder&&""===e.text.text?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{style:tq,contentEditable:!1,children:p()}),t]}):t},[_,o,s,f,p,A]),O=(0,h.useCallback)(()=>{if(g){tH("Selection from props ".concat(JSON.stringify(g)));let e=function(e,t){if(!e||!t||0===t.length)return null;let n=null,r=null,{anchor:i,focus:l}=e;return(i&&t.find(e=>I()({_key:e._key},i.path[0]))&&(n=tS(i,t)),l&&t.find(e=>I()({_key:e._key},l.path[0]))&&(r=tS(l,t)),n&&r)?{anchor:n,focus:r}:null}(g,eN(C.children,S));if(null!==e){tH("Normalized selection from props ".concat(JSON.stringify(e)));let t=eL(e,C);t&&(w.YR.select(C,t),C.operations.some(e=>"set_selection"===e.type)||D.next({type:"selection",selection:e}),C.onChange())}}},[g,C,S,D]);(0,h.useEffect)(()=>{tH("Subscribing to editor changes$");let e=D.subscribe(e=>{switch(e.type){case"ready":O();break;case"invalidValue":T(!0);break;case"value":T(!1)}});return()=>{tH("Unsubscribing to changes$"),e.unsubscribe()}},[D,O]),(0,h.useEffect)(()=>{g&&!N&&O()},[N,g,O]);let Y=(0,h.useCallback)(e=>{if(l){let t=l(e);void 0!==t&&e.preventDefault()}},[l]),W=(0,h.useCallback)(e=>{if(e.preventDefault(),C.selection){if(!i){tH("Pasting normally"),C.insertData(e.clipboardData);return}new Promise(t=>{var n;t(i({event:e,value:tC.getValue(v),path:(null==(n=C.selection)?void 0:n.focus.path)||[],schemaTypes:A}))}).then(t=>{if(tH("Custom paste function from client resolved",t),D.next({type:"loading",isLoading:!0}),!t||!t.insert){tH("No result from custom paste handler, pasting normally"),C.insertData(e.clipboardData);return}if(t&&t.insert){C.insertFragment(eE(t.insert,{schemaTypes:A})),D.next({type:"loading",isLoading:!1});return}console.warn("Your onPaste function returned something unexpected:",t)}).catch(e=>(D.next({type:"loading",isLoading:!1}),console.error(e),e))}},[D,i,v,A,C]),z=(0,h.useCallback)(()=>{D.next({type:"focus"})},[D]),J=(0,h.useCallback)(()=>{D.next({type:"blur"})},[D]),V=(0,h.useCallback)(e=>{r&&r(e)},[r]),F=C.pteWithHotKeys,U=(0,h.useMemo)(()=>void 0===m?void 0:null===m?E():(e,t)=>{m(v,t)},[v,m]),$=(0,h.useCallback)(()=>eT(C.children,A)?[{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0},placeholder:!0}]:tZ,[A,C]),H=(0,h.useMemo)(()=>(0,c.jsx)(x.CX,{autoFocus:!1,className:"pt-editable",decorate:$,onBlur:J,onCopy:Y,onDOMBeforeInput:V,onFocus:z,onKeyDown:F,onPaste:W,readOnly:_,renderElement:R,renderLeaf:j,scrollSelectionIntoView:U}),[$,Y,F,V,J,z,W,_,R,j,U]);return v?(0,c.jsx)("div",{ref:M,...k,children:N?null:H}):null})}}]);